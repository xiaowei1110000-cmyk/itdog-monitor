<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ITDOGç½‘ç«™æµ‹é€Ÿç›‘æ§ç³»ç»Ÿ - GitHubé…ç½®ä¸­å¿ƒ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .container {
            width: 100%;
            max-width: 1400px;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.25);
            padding: 40px;
            margin-top: 30px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        h1 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 2.5rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .subtitle {
            color: #6c757d;
            font-size: 1.1rem;
        }
        
        .instructions {
            background: linear-gradient(135deg, #fff9e6 0%, #ffeaa7 100%);
            border-left: 5px solid #f39c12;
            padding: 20px;
            margin: 25px 0;
            border-radius: 12px;
        }
        
        .instructions h4 {
            color: #e67e22;
            margin-bottom: 15px;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .form-group {
            margin-bottom: 30px;
        }
        
        label {
            display: block;
            margin-bottom: 10px;
            color: #495057;
            font-weight: 700;
            font-size: 1.1rem;
        }
        
        textarea, input, select {
            width: 100%;
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 1rem;
            background: #f8f9fa;
        }
        
        textarea {
            height: 200px;
            resize: vertical;
        }
        
        textarea:focus, input:focus, select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .example {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            font-size: 0.95rem;
            color: #495057;
            border-left: 5px solid #667eea;
        }
        
        .buttons {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 180px;
        }
        
        .btn-success {
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
            color: white;
        }
        
        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(46, 204, 113, 0.3);
        }
        
        .btn-telegram {
            background: linear-gradient(135deg, #0088cc 0%, #006699 100%);
            color: white;
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
            color: white;
        }
        
        .btn-secondary {
            background: #f8f9fa;
            color: #495057;
            border: 2px solid #dee2e6;
        }
        
        .btn-secondary:hover {
            background: #e9ecef;
        }
        
        .btn-info {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
        }
        
        .btn-icon {
            margin-right: 10px;
        }
        
        .config-section {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            border-left: 5px solid #28a745;
            padding: 25px;
            margin: 25px 0;
            border-radius: 12px;
        }
        
        .config-section h4 {
            color: #28a745;
            margin-bottom: 20px;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        .input-group label {
            font-weight: 600;
            color: #495057;
            margin-bottom: 8px;
            display: block;
        }
        
        .input-group input {
            font-family: monospace;
        }
        
        .status-message {
            margin-top: 15px;
            padding: 12px;
            border-radius: 8px;
            display: none;
        }
        
        .status-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .status-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        .domain-list {
            margin: 20px 0;
            padding: 20px;
            background-color: white;
            border-radius: 12px;
            max-height: 500px;
            overflow-y: auto;
        }
        
        .domain-item {
            padding: 15px;
            border-bottom: 1px solid #f8f9fa;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
        }
        
        .domain-item:hover {
            background: #f8f9fa;
        }
        
        .domain-name {
            flex: 1;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
        }
        
        .domain-status {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            min-width: 120px;
            text-align: center;
        }
        
        .status-pending {
            background: #f8f9fa;
            color: #6c757d;
        }
        
        .status-testing {
            background: #e3f2fd;
            color: #1976d2;
        }
        
        .status-success {
            background: #e8f5e8;
            color: #2e7d32;
        }
        
        .status-error {
            background: #ffebee;
            color: #c62828;
        }
        
        .status-warning {
            background: #fff8e1;
            color: #f57c00;
        }
        
        .test-controls {
            background: #e8f4fc;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
        }
        
        .progress-container {
            margin: 20px 0;
        }
        
        .progress-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }
        
        .progress-bar {
            height: 12px;
            background: #e9ecef;
            border-radius: 6px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #2ecc71 0%, #27ae60 100%);
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .test-stats {
            display: flex;
            gap: 20px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .stat-item {
            background: white;
            padding: 15px;
            border-radius: 10px;
            flex: 1;
            min-width: 150px;
            text-align: center;
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #6c757d;
            margin-bottom: 5px;
        }
        
        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .monitor-log {
            margin-top: 15px;
            max-height: 300px;
            overflow-y: auto;
            background: white;
            padding: 15px;
            border-radius: 8px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
        }
        
        .log-entry {
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .log-time {
            color: #6c757d;
            font-size: 0.8rem;
            min-width: 60px;
        }
        
        .log-content {
            flex: 1;
        }
        
        .notification-history {
            background: #fff8e1;
            border: 1px solid #ffecb3;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .notification-item {
            background: white;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            border-left: 4px solid #f39c12;
        }
        
        .notification-time {
            font-size: 0.8rem;
            color: #666;
            margin-bottom: 5px;
        }
        
        .notification-domain {
            font-weight: bold;
            color: #e67e22;
            margin-bottom: 5px;
        }
        
        .notification-message {
            font-size: 0.9rem;
            color: #333;
        }
        
        footer {
            margin-top: 50px;
            text-align: center;
            color: rgba(255, 255, 255, 0.9);
            font-size: 0.9rem;
            padding: 20px;
            width: 100%;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .buttons {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
        }
        
        /* ç»Ÿè®¡é¢æ¿ */
        .stats-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            border-top: 4px solid #3498db;
        }
        
        .stat-card.warning {
            border-top-color: #f39c12;
        }
        
        .stat-card.danger {
            border-top-color: #e74c3c;
        }
        
        .stat-card.success {
            border-top-color: #2ecc71;
        }
        
        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #2c3e50;
            margin: 10px 0;
        }
        
        .stat-title {
            font-size: 0.9rem;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        /* åœ°åŒºé€‰æ‹©å™¨ */
        .region-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }
        
        .region-option {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .region-option input[type="checkbox"] {
            width: 18px;
            height: 18px;
        }
        
        .region-option label {
            font-weight: normal;
            margin: 0;
            font-size: 0.95rem;
            cursor: pointer;
        }
        
        .advanced-settings {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            border: 2px solid #e9ecef;
        }
        
        .advanced-settings h5 {
            color: #495057;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin: 15px 0;
        }
        
        .checkbox-option {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .checkbox-option input[type="checkbox"] {
            width: 18px;
            height: 18px;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-tachometer-alt"></i> ITDOGç½‘ç«™æµ‹é€Ÿç›‘æ§ç³»ç»Ÿ</h1>
            <p class="subtitle">GitHub Pagesé…ç½®ä¸­å¿ƒ | Telegramå¼‚å¸¸é€šçŸ¥ | ä¸“ä¸šç›‘æ§è§£å†³æ–¹æ¡ˆ</p>
        </header>
        
        <div class="instructions">
            <h4><i class="fas fa-info-circle"></i> ç³»ç»Ÿè¯´æ˜</h4>
            <p>1. æœ¬ç³»ç»Ÿé€šè¿‡Tampermonkeyè„šæœ¬è‡ªåŠ¨ç›‘æ§ç½‘ç«™è¿é€šç‡ï¼ŒåŸºäºçŠ¶æ€ç 200åˆ¤æ–­</p>
            <p>2. å½“è¿é€šç‡ä½äº90%æ—¶ï¼Œè‡ªåŠ¨å‘é€ä¸“ä¸šçš„Telegramé€šçŸ¥</p>
            <p>3. æ”¯æŒæ‰¹é‡æµ‹è¯•å’Œå®šæ—¶æµ‹è¯•åŠŸèƒ½</p>
            <p>4. å¿…é¡»å…ˆé…ç½®Telegramä¿¡æ¯æ‰èƒ½ä½¿ç”¨é€šçŸ¥åŠŸèƒ½</p>
        </div>
        
        <!-- Telegramé…ç½® -->
        <div class="config-section">
            <h4><i class="fab fa-telegram"></i> Telegramé€šçŸ¥é…ç½®</h4>
            
            <div class="input-group">
                <label for="bot-token">Telegram Bot Token</label>
                <input type="password" id="bot-token" placeholder="è¾“å…¥Bot Token (æ ¼å¼: 1234567890:ABCdefGHIjklMNOpqrsTUVwxyz)">
            </div>
            
            <div class="input-group">
                <label for="chat-id">Telegram Chat ID</label>
                <input type="text" id="chat-id" placeholder="è¾“å…¥Chat ID (åœ¨@userinfobotä¸­è·å–)">
            </div>
            
            <div class="buttons">
                <button class="btn btn-telegram" id="save-config-btn">
                    <i class="fas fa-save btn-icon"></i> ä¿å­˜é…ç½®
                </button>
                <button class="btn btn-warning" id="test-config-btn">
                    <i class="fas fa-paper-plane btn-icon"></i> æµ‹è¯•é€šçŸ¥
                </button>
                <button class="btn btn-telegram" id="get-chat-id-btn">
                    <i class="fas fa-id-card btn-icon"></i> è·å–Chat ID
                </button>
                <button class="btn btn-secondary" id="clear-config-btn">
                    <i class="fas fa-trash btn-icon"></i> æ¸…é™¤é…ç½®
                </button>
            </div>
            
            <div id="config-status" class="status-message"></div>
        </div>
        
        <!-- ç»Ÿè®¡é¢æ¿ -->
        <div class="stats-panel" id="stats-panel">
            <div class="stat-card">
                <div class="stat-title">ä»Šæ—¥æµ‹è¯•</div>
                <div class="stat-number" id="today-tests">0</div>
            </div>
            <div class="stat-card warning">
                <div class="stat-title">å¼‚å¸¸ç½‘ç«™</div>
                <div class="stat-number" id="error-sites">0</div>
            </div>
            <div class="stat-card success">
                <div class="stat-title">æ­£å¸¸ç½‘ç«™</div>
                <div class="stat-number" id="success-sites">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-title">å‘é€é€šçŸ¥</div>
                <div class="stat-number" id="sent-notifications">0</div>
            </div>
        </div>
        
        <!-- æ‰¹é‡æµ‹è¯• -->
        <div class="config-section">
            <h4><i class="fas fa-globe"></i> æ‰¹é‡ç½‘ç«™æµ‹è¯•</h4>
            
            <div class="input-group">
                <label for="domains">è¦æµ‹è¯•çš„ç½‘ç«™åœ°å€ï¼ˆæ¯è¡Œä¸€ä¸ªï¼Œæ— éœ€æ·»åŠ http://ï¼‰</label>
                <textarea id="domains" placeholder="example.com&#10;google.com&#10;github.com"></textarea>
                <div class="example">
                    <strong>ç¤ºä¾‹æ ¼å¼ï¼š</strong><br>
                    alibabacloud.com<br>
                    dynadot.com<br>
                    itdog.cn<br>
                    baidu.com
                </div>
            </div>
            
            <!-- åœ°åŒºé€‰æ‹©å™¨ -->
            <div class="input-group">
                <label>æµ‹è¯•åœ°åŒºé€‰æ‹©ï¼ˆå¯é€‰ï¼‰</label>
                <div class="region-selector">
                    <div class="region-option">
                        <input type="checkbox" id="region-mainland" checked>
                        <label for="region-mainland">ä¸­å›½å¤§é™†</label>
                    </div>
                    <div class="region-option">
                        <input type="checkbox" id="region-tw" checked>
                        <label for="region-tw">ä¸­å›½å°æ¹¾</label>
                    </div>
                    <div class="region-option">
                        <input type="checkbox" id="region-hk" checked>
                        <label for="region-hk">ä¸­å›½é¦™æ¸¯</label>
                    </div>
                    <div class="region-option">
                        <input type="checkbox" id="region-mo" checked>
                        <label for="region-mo">ä¸­å›½æ¾³é—¨</label>
                    </div>
                    <div class="region-option">
                        <input type="checkbox" id="region-overseas">
                        <label for="region-overseas">æµ·å¤–åœ°åŒº</label>
                    </div>
                </div>
            </div>
            
            <!-- é«˜çº§è®¾ç½® -->
            <div class="advanced-settings">
                <h5><i class="fas fa-cog"></i> é«˜çº§è®¾ç½®</h5>
                <div class="checkbox-group">
                    <div class="checkbox-option">
                        <input type="checkbox" id="auto-fill-domains" checked>
                        <label for="auto-fill-domains">è‡ªåŠ¨å¡«å……ç¤ºä¾‹åŸŸå</label>
                    </div>
                    <div class="checkbox-option">
                        <input type="checkbox" id="wait-for-page-load" checked>
                        <label for="wait-for-page-load">ç­‰å¾…é¡µé¢å®Œå…¨åŠ è½½</label>
                    </div>
                    <div class="checkbox-option">
                        <input type="checkbox" id="auto-retry" checked>
                        <label for="auto-retry">è‡ªåŠ¨é‡è¯•å¤±è´¥æµ‹è¯•</label>
                    </div>
                </div>
            </div>
            
            <div class="buttons">
                <button class="btn btn-success" id="start-test-btn">
                    <i class="fas fa-rocket btn-icon"></i> å¼€å§‹æ‰¹é‡æµ‹è¯•
                </button>
                <button class="btn btn-secondary" id="clear-domains-btn">
                    <i class="fas fa-redo btn-icon"></i> æ¸…ç©ºåˆ—è¡¨
                </button>
                <button class="btn btn-info" id="load-default-domains-btn">
                    <i class="fas fa-download btn-icon"></i> åŠ è½½é»˜è®¤åŸŸå
                </button>
                <button class="btn btn-warning" id="test-selected-btn">
                    <i class="fas fa-bolt btn-icon"></i> æµ‹è¯•é€‰ä¸­åŸŸå
                </button>
            </div>
            
            <!-- åŸŸååˆ—è¡¨ -->
            <div class="domain-list" id="domain-list" style="display: none;">
                <h5 style="margin-bottom: 15px; color: #495057;">æµ‹è¯•é˜Ÿåˆ—</h5>
                <div id="domains-container"></div>
            </div>
            
            <!-- æµ‹è¯•æ§åˆ¶ -->
            <div class="test-controls" id="test-controls" style="display: none;">
                <div class="test-stats">
                    <div class="stat-item">
                        <div class="stat-label">å·²æµ‹è¯•</div>
                        <div class="stat-value" id="tested-count">0</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">è¿›è¡Œä¸­</div>
                        <div class="stat-value" id="active-count">0</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">å¾…æµ‹è¯•</div>
                        <div class="stat-value" id="pending-count">0</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">å¼‚å¸¸</div>
                        <div class="stat-value" id="error-count">0</div>
                    </div>
                </div>
                
                <div class="progress-container">
                    <div class="progress-info">
                        <span>æµ‹è¯•è¿›åº¦</span>
                        <span id="progress-text">0/0</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-bar"></div>
                    </div>
                </div>
                
                <div class="buttons">
                    <button class="btn btn-warning" id="pause-btn">
                        <i class="fas fa-pause btn-icon"></i> æš‚åœæµ‹è¯•
                    </button>
                    <button class="btn btn-secondary" id="stop-btn">
                        <i class="fas fa-stop btn-icon"></i> åœæ­¢å…¨éƒ¨
                    </button>
                </div>
            </div>
        </div>
        
        <!-- ç›‘æ§æ—¥å¿— -->
        <div class="test-controls" style="margin-top: 30px;">
            <h4><i class="fas fa-clipboard-list"></i> ç›‘æ§æ—¥å¿—</h4>
            <div class="monitor-log" id="monitor-log">
                <div class="log-entry">
                    <span class="log-time">å°±ç»ª</span>
                    <span class="log-content">ç³»ç»Ÿå·²å°±ç»ªï¼Œç­‰å¾…å¼€å§‹æµ‹è¯•...</span>
                </div>
            </div>
        </div>
        
        <!-- é€šçŸ¥å†å² -->
        <div class="notification-history" id="notification-history" style="display: none;">
            <h5><i class="fas fa-bell"></i> é€šçŸ¥å†å²è®°å½•</h5>
            <div id="notifications-container"></div>
        </div>
        
        <footer>
            <p>ITDOGç½‘ç«™æµ‹é€Ÿç›‘æ§ç³»ç»Ÿ v6.5 | Â© 2026 GitHub Pagesé…ç½®ä¸­å¿ƒ | ä¸“ä¸šç½‘ç«™ç›‘æ§è§£å†³æ–¹æ¡ˆ</p>
            <p>åœ¨ä½¿ç”¨å‰è¯·ç¡®ä¿å·²å®‰è£… <a href="https://www.tampermonkey.net/" target="_blank" style="color: white; text-decoration: underline;">Tampermonkey</a> æ‰©å±•</p>
        </footer>
    </div>

    <script>
        // ============================================
        // ITDOGç›‘æ§ç³»ç»Ÿ - ä¸»é¡µé¢JavaScriptä»£ç 
        // ============================================
        document.addEventListener('DOMContentLoaded', function() {
            // å…ƒç´ å¼•ç”¨
            const elements = {
                botToken: document.getElementById('bot-token'),
                chatId: document.getElementById('chat-id'),
                saveConfigBtn: document.getElementById('save-config-btn'),
                testConfigBtn: document.getElementById('test-config-btn'),
                getChatIdBtn: document.getElementById('get-chat-id-btn'),
                clearConfigBtn: document.getElementById('clear-config-btn'),
                configStatus: document.getElementById('config-status'),
                domains: document.getElementById('domains'),
                startTestBtn: document.getElementById('start-test-btn'),
                clearDomainsBtn: document.getElementById('clear-domains-btn'),
                loadDefaultDomainsBtn: document.getElementById('load-default-domains-btn'),
                testSelectedBtn: document.getElementById('test-selected-btn'),
                domainList: document.getElementById('domain-list'),
                domainsContainer: document.getElementById('domains-container'),
                testControls: document.getElementById('test-controls'),
                monitorLog: document.getElementById('monitor-log'),
                pauseBtn: document.getElementById('pause-btn'),
                stopBtn: document.getElementById('stop-btn'),
                testedCount: document.getElementById('tested-count'),
                activeCount: document.getElementById('active-count'),
                pendingCount: document.getElementById('pending-count'),
                errorCount: document.getElementById('error-count'),
                progressText: document.getElementById('progress-text'),
                progressBar: document.getElementById('progress-bar'),
                notificationHistory: document.getElementById('notification-history'),
                notificationsContainer: document.getElementById('notifications-container'),
                // ç»Ÿè®¡å…ƒç´ 
                todayTests: document.getElementById('today-tests'),
                errorSites: document.getElementById('error-sites'),
                successSites: document.getElementById('success-sites'),
                sentNotifications: document.getElementById('sent-notifications'),
                // åœ°åŒºé€‰æ‹©å™¨
                regionMainland: document.getElementById('region-mainland'),
                regionTW: document.getElementById('region-tw'),
                regionHK: document.getElementById('region-hk'),
                regionMO: document.getElementById('region-mo'),
                regionOverseas: document.getElementById('region-overseas'),
                // é«˜çº§è®¾ç½®
                autoFillDomains: document.getElementById('auto-fill-domains'),
                waitForPageLoad: document.getElementById('wait-for-page-load'),
                autoRetry: document.getElementById('auto-retry')
            };

            // çŠ¶æ€å˜é‡
            let telegramConfig = null;
            let domainArray = [];
            let domainStatus = {};
            let currentIndex = 0;
            let isTesting = false;
            let isPaused = false;
            let activeTabs = new Map(); // ä½¿ç”¨Mapå­˜å‚¨æ‰“å¼€çš„æ ‡ç­¾é¡µ
            let batchSize = 2; // åŒæ—¶æ‰“å¼€çš„æ ‡ç­¾é¡µæ•°é‡
            let testDelay = 3000; // æ ‡ç­¾é¡µé—´æ‰“å¼€å»¶è¿Ÿ
            let retryCount = 0; // é‡è¯•æ¬¡æ•°
            
            // ç»Ÿè®¡å˜é‡
            let stats = {
                todayTests: 0,
                errorSites: 0,
                successSites: 0,
                sentNotifications: 0,
                lastReset: new Date().toDateString()
            };

            // é»˜è®¤åŸŸååˆ—è¡¨
            const defaultDomains = [
                'alibabacloud.com',
                'dynadot.com',
                'itdog.cn',
                'baidu.com',
                'google.com',
                'github.com',
                'cloudflare.com',
                'akamai.com',
                'tencent.com',
                'aliyun.com',
                'huaweicloud.com',
                'aws.amazon.com',
                'azure.com',
                'oracle.com'
            ];

            // åŠ è½½é…ç½®å’ŒçŠ¶æ€
            function loadConfig() {
                try {
                    // åŠ è½½Telegramé…ç½®
                    const configStr = localStorage.getItem('telegram_config');
                    if (configStr) {
                        telegramConfig = JSON.parse(configStr);
                        elements.botToken.value = telegramConfig.botToken || '';
                        elements.chatId.value = telegramConfig.chatId || '';
                        showStatus('å·²åŠ è½½ä¿å­˜çš„é…ç½®', 'success');
                    }
                    
                    // åŠ è½½åŸŸååˆ—è¡¨
                    const domainsConfig = localStorage.getItem('domains_config');
                    if (domainsConfig) {
                        elements.domains.value = domainsConfig;
                    }
                    
                    // åŠ è½½åœ°åŒºè®¾ç½®
                    const regionConfig = localStorage.getItem('region_config');
                    if (regionConfig) {
                        const regions = JSON.parse(regionConfig);
                        elements.regionMainland.checked = regions.mainland || true;
                        elements.regionTW.checked = regions.tw || true;
                        elements.regionHK.checked = regions.hk || true;
                        elements.regionMO.checked = regions.mo || true;
                        elements.regionOverseas.checked = regions.overseas || false;
                    }
                    
                    // åŠ è½½é«˜çº§è®¾ç½®
                    const advancedConfig = localStorage.getItem('advanced_config');
                    if (advancedConfig) {
                        const advanced = JSON.parse(advancedConfig);
                        elements.autoFillDomains.checked = advanced.autoFillDomains !== false;
                        elements.waitForPageLoad.checked = advanced.waitForPageLoad !== false;
                        elements.autoRetry.checked = advanced.autoRetry !== false;
                    }
                    
                    // åŠ è½½ç»Ÿè®¡ä¿¡æ¯
                    const statsConfig = localStorage.getItem('monitor_stats');
                    if (statsConfig) {
                        const savedStats = JSON.parse(statsConfig);
                        // å¦‚æœæ˜¯åŒä¸€å¤©ï¼Œæ¢å¤ç»Ÿè®¡
                        if (savedStats.lastReset === new Date().toDateString()) {
                            stats = savedStats;
                            updateStatsDisplay();
                        } else {
                            // æ–°çš„ä¸€å¤©ï¼Œé‡ç½®ç»Ÿè®¡
                            resetDailyStats();
                        }
                    }
                    
                    // åŠ è½½é€šçŸ¥å†å²
                    loadNotificationHistory();
                    
                    // è‡ªåŠ¨å¡«å……åŸŸå
                    if (elements.autoFillDomains.checked && (!domainsConfig || domainsConfig.trim() === '')) {
                        elements.domains.value = defaultDomains.join('\n');
                        saveDomains();
                    }
                    
                } catch (error) {
                    console.error('åŠ è½½é…ç½®å¤±è´¥:', error);
                    showStatus('åŠ è½½é…ç½®å¤±è´¥ï¼Œè¯·æ£€æŸ¥æµè§ˆå™¨å­˜å‚¨', 'error');
                }
            }

            // ä¿å­˜é…ç½®
            function saveConfig() {
                const botToken = elements.botToken.value.trim();
                const chatId = elements.chatId.value.trim();
                
                if (!botToken) {
                    showStatus('è¯·è¾“å…¥Bot Token', 'error');
                    return;
                }
                
                if (!chatId) {
                    showStatus('è¯·è¾“å…¥Chat ID', 'error');
                    return;
                }
                
                if (!botToken.match(/^\d+:[A-Za-z0-9_-]+$/)) {
                    showStatus('Bot Tokenæ ¼å¼ä¸æ­£ç¡®', 'error');
                    return;
                }
                
                try {
                    telegramConfig = {
                        botToken: botToken,
                        chatId: chatId,
                        lastUpdated: new Date().toISOString()
                    };
                    
                    localStorage.setItem('telegram_config', JSON.stringify(telegramConfig));
                    showStatus('Telegramé…ç½®ä¿å­˜æˆåŠŸ', 'success');
                    addLog('é…ç½®å·²ä¿å­˜', 'info');
                } catch (error) {
                    showStatus('ä¿å­˜å¤±è´¥: ' + error.message, 'error');
                    addLog('ä¿å­˜é…ç½®å¤±è´¥: ' + error.message, 'error');
                }
            }

            // ä¿å­˜åœ°åŒºè®¾ç½®
            function saveRegionSettings() {
                const regionConfig = {
                    mainland: elements.regionMainland.checked,
                    tw: elements.regionTW.checked,
                    hk: elements.regionHK.checked,
                    mo: elements.regionMO.checked,
                    overseas: elements.regionOverseas.checked
                };
                
                localStorage.setItem('region_config', JSON.stringify(regionConfig));
            }

            // ä¿å­˜é«˜çº§è®¾ç½®
            function saveAdvancedSettings() {
                const advancedConfig = {
                    autoFillDomains: elements.autoFillDomains.checked,
                    waitForPageLoad: elements.waitForPageLoad.checked,
                    autoRetry: elements.autoRetry.checked
                };
                
                localStorage.setItem('advanced_config', JSON.stringify(advancedConfig));
            }

            // ä¿å­˜åŸŸååˆ—è¡¨
            function saveDomains() {
                localStorage.setItem('domains_config', elements.domains.value);
            }

            // æµ‹è¯•é…ç½®
            function testConfig() {
                if (!telegramConfig) {
                    showStatus('è¯·å…ˆä¿å­˜é…ç½®', 'error');
                    return;
                }
                
                const { botToken, chatId } = telegramConfig;
                
                showStatus('æ­£åœ¨æµ‹è¯•Telegramè¿æ¥...', 'info');
                addLog('æµ‹è¯•Telegramè¿æ¥...', 'info');
                
                const now = new Date();
                const currentTime = now.toLocaleString('zh-CN', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit',
                    hour12: false
                }).replace(/\//g, '-');
                
                const testMessage = `ğŸ“± *ITDOGç›‘æ§ç³»ç»Ÿ - è¿æ¥æµ‹è¯•*\n\n` +
                    `âœ… *æµ‹è¯•çŠ¶æ€:* è¿æ¥æˆåŠŸ\n` +
                    `ğŸ• *æµ‹è¯•æ—¶é—´:* ${currentTime}\n` +
                    `ğŸ“Š *ç³»ç»Ÿç‰ˆæœ¬:* v6.5\n` +
                    `ğŸ”§ *é…ç½®çŠ¶æ€:* å·²éªŒè¯\n\n` +
                    `ç³»ç»Ÿå·²å‡†å¤‡å°±ç»ªï¼Œå¯ä»¥å¼€å§‹ç½‘ç«™ç›‘æ§ä»»åŠ¡ã€‚`;
                
                sendTelegramMessage(testMessage)
                    .then(response => {
                        if (response.ok) {
                            showStatus('âœ… Telegramè¿æ¥æµ‹è¯•æˆåŠŸï¼Œè¯·æ£€æŸ¥Telegramæ¶ˆæ¯', 'success');
                            addLog('Telegramè¿æ¥æµ‹è¯•æˆåŠŸ', 'success');
                        } else {
                            showStatus('âŒ Telegramè¿æ¥å¤±è´¥: ' + (response.description || 'æœªçŸ¥é”™è¯¯'), 'error');
                            addLog('Telegramè¿æ¥å¤±è´¥: ' + response.description, 'error');
                        }
                    })
                    .catch(error => {
                        showStatus('âŒ ç½‘ç»œé”™è¯¯: ' + error.message, 'error');
                        addLog('ç½‘ç»œé”™è¯¯: ' + error.message, 'error');
                    });
            }

            // è·å–Chat ID
            function getChatId() {
                const botToken = elements.botToken.value.trim();
                
                if (!botToken) {
                    showStatus('è¯·è¾“å…¥Bot Token', 'error');
                    return;
                }
                
                if (!botToken.match(/^\d+:[A-Za-z0-9_-]+$/)) {
                    showStatus('Bot Tokenæ ¼å¼ä¸æ­£ç¡®', 'error');
                    return;
                }
                
                showStatus('æ­£åœ¨è·å–Chat ID...', 'info');
                addLog('è·å–Chat ID...', 'info');
                
                fetch(`https://api.telegram.org/bot${botToken}/getUpdates`)
                    .then(response => response.json())
                    .then(data => {
                        if (!data.ok) {
                            showStatus('è¯·æ±‚å¤±è´¥: ' + data.description, 'error');
                            addLog('è·å–Chat IDå¤±è´¥: ' + data.description, 'error');
                            return;
                        }
                        
                        if (!data.result || data.result.length === 0) {
                            showStatus('æ²¡æœ‰æ‰¾åˆ°æ¶ˆæ¯ï¼Œè¯·å…ˆç»™æœºå™¨äººå‘é€ä¸€æ¡æ¶ˆæ¯', 'error');
                            addLog('æœªæ‰¾åˆ°Chat IDï¼Œè¯·å…ˆç»™æœºå™¨äººå‘é€æ¶ˆæ¯', 'warning');
                            return;
                        }
                        
                        let message = 'æ‰¾åˆ°çš„Chat ID:\n\n';
                        data.result.forEach((update, index) => {
                            if (update.message && update.message.chat) {
                                const chat = update.message.chat;
                                message += `${index + 1}. ç±»å‹: ${chat.type}\n`;
                                message += `   Chat ID: ${chat.id}\n`;
                                message += `   æ ‡é¢˜: ${chat.title || 'ç§èŠ'}\n\n`;
                                
                                if (chat.type === 'private') {
                                    elements.chatId.value = chat.id;
                                }
                            }
                        });
                        
                        const selectedId = prompt(message + '\nè¯·é€‰æ‹©è¦ä½¿ç”¨çš„Chat IDï¼ˆè¾“å…¥æ•°å­—ï¼‰:');
                        if (selectedId && data.result[selectedId - 1] && data.result[selectedId - 1].message) {
                            const chatId = data.result[selectedId - 1].message.chat.id;
                            elements.chatId.value = chatId;
                            showStatus('Chat IDå·²è®¾ç½®', 'success');
                            addLog('Chat IDå·²è®¾ç½®: ' + chatId, 'success');
                        }
                    })
                    .catch(error => {
                        showStatus('ç½‘ç»œé”™è¯¯: ' + error.message, 'error');
                        addLog('ç½‘ç»œé”™è¯¯: ' + error.message, 'error');
                    });
            }

            // æ¸…é™¤é…ç½®
            function clearConfig() {
                if (confirm('ç¡®å®šè¦æ¸…é™¤Telegramé…ç½®å—ï¼Ÿ')) {
                    telegramConfig = null;
                    elements.botToken.value = '';
                    elements.chatId.value = '';
                    localStorage.removeItem('telegram_config');
                    showStatus('é…ç½®å·²æ¸…é™¤', 'info');
                    addLog('é…ç½®å·²æ¸…é™¤', 'warning');
                }
            }

            // åŠ è½½é»˜è®¤åŸŸå
            function loadDefaultDomains() {
                elements.domains.value = defaultDomains.join('\n');
                saveDomains();
                showStatus('å·²åŠ è½½é»˜è®¤åŸŸååˆ—è¡¨', 'success');
                addLog('å·²åŠ è½½é»˜è®¤åŸŸååˆ—è¡¨', 'info');
            }

            // å¼€å§‹æ‰¹é‡æµ‹è¯•
            function startBatchTest() {
                const domains = elements.domains.value.trim();
                if (!domains) {
                    showStatus('è¯·è¾“å…¥è¦æµ‹è¯•çš„ç½‘ç«™åœ°å€', 'error');
                    return;
                }
                
                if (!telegramConfig) {
                    showStatus('è¯·å…ˆé…ç½®Telegramä¿¡æ¯', 'error');
                    return;
                }
                
                // ä¿å­˜åŸŸååˆ—è¡¨å’Œè®¾ç½®
                saveDomains();
                saveRegionSettings();
                saveAdvancedSettings();
                
                // è§£æåŸŸååˆ—è¡¨
                domainArray = domains.split('\n')
                    .map(domain => domain.trim())
                    .filter(domain => domain.length > 0)
                    .map(domain => {
                        // ç§»é™¤http://æˆ–https://å‰ç¼€
                        return domain.replace(/^https?:\/\//, '');
                    });
                
                if (domainArray.length === 0) return;
                
                // æ˜¾ç¤ºåŸŸååˆ—è¡¨
                elements.domainsContainer.innerHTML = '';
                domainStatus = {};
                
                domainArray.forEach((domain, index) => {
                    domainStatus[index] = { 
                        status: 'pending', 
                        rate: 0,
                        retries: 0,
                        maxRetries: elements.autoRetry.checked ? 2 : 0
                    };
                    
                    const item = document.createElement('div');
                    item.className = 'domain-item';
                    item.dataset.index = index;
                    item.innerHTML = `
                        <div class="domain-name">${index + 1}. ${domain}</div>
                        <div class="domain-status status-pending" id="status-${index}">ç­‰å¾…æµ‹è¯•</div>
                    `;
                    elements.domainsContainer.appendChild(item);
                });
                
                elements.domainList.style.display = 'block';
                elements.testControls.style.display = 'block';
                
                // é‡ç½®çŠ¶æ€
                currentIndex = 0;
                isTesting = true;
                isPaused = false;
                retryCount = 0;
                activeTabs.clear();
                
                elements.testedCount.textContent = '0';
                elements.activeCount.textContent = '0';
                elements.pendingCount.textContent = domainArray.length;
                elements.errorCount.textContent = '0';
                elements.progressText.textContent = `0/${domainArray.length}`;
                elements.progressBar.style.width = '0%';
                
                addLog(`å¼€å§‹æ‰¹é‡æµ‹è¯•ï¼Œå…± ${domainArray.length} ä¸ªåŸŸå`, 'info');
                stats.todayTests += domainArray.length;
                updateStatsDisplay();
                saveStats();
                
                // å¼€å§‹æµ‹è¯•
                openNextBatch();
            }

            // æ‰“å¼€ä¸‹ä¸€æ‰¹æ ‡ç­¾é¡µ
            function openNextBatch() {
                if (!isTesting || isPaused || currentIndex >= domainArray.length) {
                    checkTestCompletion();
                    return;
                }
                
                const batchCount = Math.min(batchSize, domainArray.length - currentIndex);
                addLog(`æ‰“å¼€æ‰¹æ¬¡ ${Math.floor(currentIndex / batchSize) + 1}ï¼Œå…± ${batchCount} ä¸ªåŸŸå`, 'info');
                
                for (let i = 0; i < batchCount; i++) {
                    const domainIndex = currentIndex + i;
                    const domain = domainArray[domainIndex];
                    
                    // æ›´æ–°çŠ¶æ€
                    updateDomainStatus(domainIndex, 'testing', 0);
                    
                    // å»¶è¿Ÿæ‰“å¼€
                    setTimeout(() => {
                        openITDOGTab(domain, domainIndex);
                    }, i * 1000);
                }
                
                currentIndex += batchCount;
                updateProgress();
                
                // å®‰æ’ä¸‹ä¸€æ‰¹æ¬¡
                if (currentIndex < domainArray.length && !isPaused) {
                    setTimeout(openNextBatch, testDelay);
                }
            }

            // æ‰“å¼€ITDOGæ ‡ç­¾é¡µ
            function openITDOGTab(domain, index) {
                try {
                    // æ„å»ºå¸¦å‚æ•°çš„URL
                    const params = new URLSearchParams();
                    params.append('domain', domain);
                    
                    // æ·»åŠ åœ°åŒºå‚æ•°
                    const regions = [];
                    if (elements.regionMainland.checked) regions.push('mainland');
                    if (elements.regionTW.checked) regions.push('tw');
                    if (elements.regionHK.checked) regions.push('hk');
                    if (elements.regionMO.checked) regions.push('mo');
                    if (elements.regionOverseas.checked) regions.push('overseas');
                    
                    if (regions.length > 0) {
                        params.append('regions', regions.join(','));
                    }
                    
                    const url = `https://www.itdog.cn/http/?${params.toString()}`;
                    
                    // æ‰“å¼€æ–°æ ‡ç­¾é¡µ
                    const tab = window.open(url, `itdog_tab_${index}`);
                    
                    if (tab) {
                        activeTabs.set(index, {
                            tab: tab,
                            domain: domain,
                            openedAt: Date.now(),
                            status: 'opened',
                            checked: false
                        });
                        
                        addLog(`æ ‡ç­¾é¡µå·²æ‰“å¼€: ${domain}`, 'info');
                        
                        // è®¾ç½®è¶…æ—¶æ£€æŸ¥
                        setTimeout(() => {
                            checkTabStatus(index);
                        }, 180000); // 3åˆ†é’Ÿè¶…æ—¶
                        
                    } else {
                        addLog(`âŒ æ— æ³•æ‰“å¼€æ ‡ç­¾é¡µ: ${domain} (å¯èƒ½è¢«æµè§ˆå™¨é˜»æ­¢)`, 'error');
                        handleTestFailure(index, 'tab_blocked');
                    }
                } catch (error) {
                    addLog(`âŒ æ‰“å¼€æ ‡ç­¾é¡µå‡ºé”™: ${error.message}`, 'error');
                    handleTestFailure(index, 'open_error');
                }
            }

            // å¤„ç†æµ‹è¯•å¤±è´¥
            function handleTestFailure(index, reason) {
                const status = domainStatus[index];
                if (status.retries < status.maxRetries) {
                    status.retries++;
                    addLog(`ğŸ”„ ç¬¬${status.retries}æ¬¡é‡è¯•: ${domainArray[index]}`, 'info');
                    
                    // ç­‰å¾…åé‡è¯•
                    setTimeout(() => {
                        openITDOGTab(domainArray[index], index);
                    }, 5000);
                } else {
                    updateDomainStatus(index, 'error', 0);
                    activeTabs.delete(index);
                }
            }

            // æ£€æŸ¥æ ‡ç­¾é¡µçŠ¶æ€
            function checkTabStatus(index) {
                const tabInfo = activeTabs.get(index);
                if (!tabInfo) return;
                
                try {
                    if (tabInfo.tab.closed) {
                        activeTabs.delete(index);
                        if (domainStatus[index] && domainStatus[index].status === 'testing') {
                            handleTestFailure(index, 'tab_closed');
                        }
                    } else {
                        // å¦‚æœæ ‡ç­¾é¡µè¿˜åœ¨ï¼Œä½†è¶…è¿‡4åˆ†é’Ÿï¼Œå¼ºåˆ¶å…³é—­
                        if (Date.now() - tabInfo.openedAt > 240000) {
                            addLog(`â° æ ‡ç­¾é¡µè¶…æ—¶: ${tabInfo.domain}ï¼Œå¼ºåˆ¶å…³é—­`, 'warning');
                            try {
                                tabInfo.tab.close();
                            } catch (e) {}
                            activeTabs.delete(index);
                            handleTestFailure(index, 'timeout');
                        }
                    }
                } catch (e) {
                    // è·¨åŸŸè®¿é—®é”™è¯¯ï¼Œå¯èƒ½æ ‡ç­¾é¡µå·²å…³é—­
                    activeTabs.delete(index);
                    if (domainStatus[index] && domainStatus[index].status === 'testing') {
                        handleTestFailure(index, 'tab_closed');
                    }
                }
            }

            // æ›´æ–°åŸŸåçŠ¶æ€
            function updateDomainStatus(index, status, rate) {
                if (!domainStatus[index]) return;
                
                domainStatus[index].status = status;
                domainStatus[index].rate = rate;
                
                const statusElement = document.getElementById(`status-${index}`);
                if (statusElement) {
                    statusElement.textContent = getStatusText(status, rate);
                    statusElement.className = `domain-status ${getStatusClass(status)}`;
                }
                
                // æ›´æ–°ç»Ÿè®¡
                if (status === 'error' || status === 'lowrate' || status === 'timeout') {
                    if (domainStatus[index].status !== 'error' && domainStatus[index].status !== 'lowrate' && domainStatus[index].status !== 'timeout') {
                        stats.errorSites++;
                    }
                } else if (status === 'success') {
                    if (domainStatus[index].status !== 'success') {
                        stats.successSites++;
                    }
                }
                
                updateStatsDisplay();
            }

            // è·å–çŠ¶æ€æ–‡æœ¬
            function getStatusText(status, rate) {
                switch(status) {
                    case 'pending': return 'ç­‰å¾…æµ‹è¯•';
                    case 'testing': return 'æµ‹è¯•ä¸­...';
                    case 'success': return `æ­£å¸¸ ${rate}%`;
                    case 'lowrate': return `å¼‚å¸¸ ${rate}%`;
                    case 'error': return 'æµ‹è¯•å¤±è´¥';
                    case 'timeout': return 'è¶…æ—¶';
                    case 'retrying': return `é‡è¯•ä¸­...`;
                    default: return 'æœªçŸ¥';
                }
            }

            // è·å–çŠ¶æ€ç±»å
            function getStatusClass(status) {
                switch(status) {
                    case 'testing': 
                    case 'retrying': return 'status-testing';
                    case 'success': return 'status-success';
                    case 'lowrate': return 'status-warning';
                    case 'error': 
                    case 'timeout': return 'status-error';
                    default: return 'status-pending';
                }
            }

            // æ›´æ–°è¿›åº¦
            function updateProgress() {
                const tested = Object.values(domainStatus).filter(s => 
                    s.status === 'success' || s.status === 'lowrate' || s.status === 'error' || s.status === 'timeout'
                ).length;
                
                const errors = Object.values(domainStatus).filter(s => 
                    s.status === 'lowrate' || s.status === 'error' || s.status === 'timeout'
                ).length;
                
                elements.testedCount.textContent = tested;
                elements.activeCount.textContent = activeTabs.size;
                elements.pendingCount.textContent = domainArray.length - currentIndex;
                elements.errorCount.textContent = errors;
                elements.progressText.textContent = `${tested}/${domainArray.length}`;
                
                const progressPercent = (tested / domainArray.length) * 100;
                elements.progressBar.style.width = `${progressPercent}%`;
            }

            // æ£€æŸ¥æµ‹è¯•æ˜¯å¦å®Œæˆ
            function checkTestCompletion() {
                if (!isTesting) return;
                
                const completed = Object.values(domainStatus).every(s => 
                    s.status === 'success' || s.status === 'lowrate' || s.status === 'error' || s.status === 'timeout'
                );
                
                if (completed && activeTabs.size === 0) {
                    isTesting = false;
                    
                    // è®¡ç®—ç»Ÿè®¡
                    const successCount = Object.values(domainStatus).filter(s => s.status === 'success').length;
                    const lowrateCount = Object.values(domainStatus).filter(s => s.status === 'lowrate').length;
                    const errorCount = Object.values(domainStatus).filter(s => s.status === 'error' || s.status === 'timeout').length;
                    
                    addLog(`âœ… æ‰€æœ‰åŸŸåæµ‹è¯•å®Œæˆ - æˆåŠŸ: ${successCount}, ä½è¿é€šç‡: ${lowrateCount}, å¤±è´¥: ${errorCount}`, 'success');
                    showStatus('æ‰¹é‡æµ‹è¯•å®Œæˆ', 'success');
                    
                    // ä¿å­˜ç»Ÿè®¡
                    saveStats();
                }
            }

            // æš‚åœ/ç»§ç»­æµ‹è¯•
            function pauseTest() {
                if (!isTesting) return;
                
                if (isPaused) {
                    isPaused = false;
                    elements.pauseBtn.innerHTML = '<i class="fas fa-pause btn-icon"></i> æš‚åœæµ‹è¯•';
                    addLog('ç»§ç»­æµ‹è¯•', 'info');
                    openNextBatch();
                } else {
                    isPaused = true;
                    elements.pauseBtn.innerHTML = '<i class="fas fa-play btn-icon"></i> ç»§ç»­æµ‹è¯•';
                    addLog('æµ‹è¯•æš‚åœ', 'warning');
                }
            }

            // åœæ­¢æµ‹è¯•
            function stopTest() {
                if (!isTesting && activeTabs.size === 0) return;
                
                isTesting = false;
                isPaused = false;
                
                // å…³é—­æ‰€æœ‰æ‰“å¼€çš„æ ‡ç­¾é¡µ
                activeTabs.forEach((tabInfo, index) => {
                    try {
                        if (tabInfo.tab && !tabInfo.tab.closed) {
                            tabInfo.tab.close();
                        }
                    } catch (e) {
                        console.error('å…³é—­æ ‡ç­¾é¡µå¤±è´¥:', e);
                    }
                });
                
                activeTabs.clear();
                
                addLog('æµ‹è¯•å·²åœæ­¢', 'warning');
                showStatus('æµ‹è¯•å·²åœæ­¢', 'info');
                
                // æ›´æ–°æœªå®Œæˆçš„åŸŸåçŠ¶æ€
                for (let i = 0; i < domainArray.length; i++) {
                    if (domainStatus[i] && (domainStatus[i].status === 'pending' || domainStatus[i].status === 'testing')) {
                        updateDomainStatus(i, 'error', 0);
                    }
                }
                
                updateProgress();
            }

            // å‘é€Telegramæ¶ˆæ¯
            function sendTelegramMessage(message) {
                if (!telegramConfig) {
                    return Promise.reject(new Error('Telegramé…ç½®æœªè®¾ç½®'));
                }
                
                const { botToken, chatId } = telegramConfig;
                
                return fetch(`https://api.telegram.org/bot${botToken}/sendMessage`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        chat_id: chatId,
                        text: message,
                        parse_mode: 'Markdown',
                        disable_web_page_preview: true
                    })
                })
                .then(response => response.json());
            }

            // å‘é€å¼‚å¸¸é€šçŸ¥
            function sendLowRateNotification(domain, results) {
                if (!telegramConfig) {
                    addLog(`æ— æ³•å‘é€é€šçŸ¥: Telegramé…ç½®æœªè®¾ç½®`, 'error');
                    return Promise.resolve(false);
                }
                
                const now = new Date();
                const currentTime = now.toLocaleString('zh-CN', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit',
                    hour12: false
                }).replace(/\//g, '-');
                
                // æ„å»ºä¸“ä¸šçš„é€šçŸ¥æ¶ˆæ¯
                const message = `ğŸš¨ *ç½‘ç«™ç›‘æ§å‘Šè­¦é€šçŸ¥*\n\n` +
                    `ğŸ”´ *å‘Šè­¦çº§åˆ«:* ä¸¥é‡\n` +
                    `ğŸŒ *é—®é¢˜åŸŸå:* \`${domain}\`\n` +
                    `ğŸ• *æ£€æµ‹æ—¶é—´:* ${currentTime}\n\n` +
                    `ğŸ“Š *æµ‹è¯•ç»“æœè¯¦æƒ…*\n` +
                    `â”œ æ€»æµ‹è¯•èŠ‚ç‚¹: ${results.totalTests || 0}\n` +
                    `â”œ æ­£å¸¸èŠ‚ç‚¹(200): ${results.success200Tests || 0}\n` +
                    `â”œ å¼‚å¸¸èŠ‚ç‚¹: ${(results.totalTests || 0) - (results.success200Tests || 0)}\n` +
                    `â”” è¿é€šç‡: *${results.connectivityRate || 0}%*\n\n` +
                    `ğŸ“‹ *å¼‚å¸¸çŠ¶æ€ç åˆ†å¸ƒ*\n` +
                    `${getStatusCodeDistribution(results.otherStatusCodes)}\n` +
                    `âš ï¸ *å‘Šè­¦è¯´æ˜:* ç½‘ç«™è¿é€šç‡ä½äº90%ï¼Œè¯·ç«‹å³æ£€æŸ¥ï¼\n\n` +
                    `ğŸ”§ *å»ºè®®æ“ä½œ*\n` +
                    `1. æ£€æŸ¥æœåŠ¡å™¨çŠ¶æ€\n` +
                    `2. æ£€æŸ¥DNSè§£æ\n` +
                    `3. æ£€æŸ¥é˜²ç«å¢™è®¾ç½®\n` +
                    `4. è”ç³»æœåŠ¡æä¾›å•†\n\n` +
                    `#ç½‘ç«™ç›‘æ§ #è¿é€šç‡å‘Šè­¦ #${domain.split('.')[0]}`;
                
                return sendTelegramMessage(message)
                    .then(response => {
                        if (response.ok) {
                            stats.sentNotifications++;
                            updateStatsDisplay();
                            saveStats();
                            addNotificationToHistory(domain, results.connectivityRate, currentTime, message);
                            return true;
                        } else {
                            throw new Error(response.description || 'å‘é€å¤±è´¥');
                        }
                    })
                    .catch(error => {
                        addLog(`å‘é€Telegramé€šçŸ¥å¤±è´¥: ${error.message}`, 'error');
                        return false;
                    });
            }

            // è·å–çŠ¶æ€ç åˆ†å¸ƒ
            function getStatusCodeDistribution(statusCodes) {
                if (!statusCodes || statusCodes.length === 0) {
                    return 'æš‚æ— å¼‚å¸¸çŠ¶æ€ç æ•°æ®\n';
                }
                
                const countMap = {};
                statusCodes.forEach(code => {
                    countMap[code] = (countMap[code] || 0) + 1;
                });
                
                let distribution = '';
                Object.entries(countMap).forEach(([code, count], index) => {
                    if (index === Object.keys(countMap).length - 1) {
                        distribution += `â”” ${code}: ${count}ä¸ª\n`;
                    } else {
                        distribution += `â”œ ${code}: ${count}ä¸ª\n`;
                    }
                });
                
                return distribution;
            }

            // æ·»åŠ é€šçŸ¥åˆ°å†å²è®°å½•
            function addNotificationToHistory(domain, rate, time, message) {
                const notification = {
                    domain: domain,
                    rate: rate,
                    time: time,
                    message: message,
                    timestamp: Date.now()
                };
                
                // è·å–ç°æœ‰å†å²è®°å½•
                let history = [];
                try {
                    const historyStr = localStorage.getItem('notification_history');
                    if (historyStr) {
                        history = JSON.parse(historyStr);
                    }
                } catch (e) {
                    console.error('è¯»å–é€šçŸ¥å†å²å¤±è´¥:', e);
                }
                
                // æ·»åŠ åˆ°å†å²è®°å½•
                history.unshift(notification);
                
                // é™åˆ¶å†å²è®°å½•æ•°é‡
                if (history.length > 50) {
                    history = history.slice(0, 50);
                }
                
                // ä¿å­˜å†å²è®°å½•
                localStorage.setItem('notification_history', JSON.stringify(history));
                
                // æ˜¾ç¤ºé€šçŸ¥å†å²
                displayNotificationHistory();
            }

            // æ˜¾ç¤ºé€šçŸ¥å†å²
            function displayNotificationHistory() {
                let history = [];
                try {
                    const historyStr = localStorage.getItem('notification_history');
                    if (historyStr) {
                        history = JSON.parse(historyStr);
                    }
                } catch (e) {
                    console.error('è¯»å–é€šçŸ¥å†å²å¤±è´¥:', e);
                }
                
                if (history.length === 0) {
                    elements.notificationsContainer.innerHTML = '<div style="text-align: center; padding: 20px; color: #666;">æš‚æ— é€šçŸ¥è®°å½•</div>';
                    return;
                }
                
                let html = '';
                history.forEach((notification, index) => {
                    html += `
                        <div class="notification-item">
                            <div class="notification-time">${notification.time}</div>
                            <div class="notification-domain">${notification.domain} (${notification.rate}%)</div>
                            <div class="notification-message">${notification.message.replace(/\*/g, '').substring(0, 100)}...</div>
                        </div>
                    `;
                });
                
                elements.notificationsContainer.innerHTML = html;
                elements.notificationHistory.style.display = 'block';
            }

            // åŠ è½½é€šçŸ¥å†å²
            function loadNotificationHistory() {
                displayNotificationHistory();
            }

            // æ›´æ–°ç»Ÿè®¡æ˜¾ç¤º
            function updateStatsDisplay() {
                elements.todayTests.textContent = stats.todayTests;
                elements.errorSites.textContent = stats.errorSites;
                elements.successSites.textContent = stats.successSites;
                elements.sentNotifications.textContent = stats.sentNotifications;
            }

            // ä¿å­˜ç»Ÿè®¡ä¿¡æ¯
            function saveStats() {
                stats.lastReset = new Date().toDateString();
                localStorage.setItem('monitor_stats', JSON.stringify(stats));
            }

            // é‡ç½®æ¯æ—¥ç»Ÿè®¡
            function resetDailyStats() {
                stats = {
                    todayTests: 0,
                    errorSites: 0,
                    successSites: 0,
                    sentNotifications: 0,
                    lastReset: new Date().toDateString()
                };
                updateStatsDisplay();
                saveStats();
            }

            // æ£€æŸ¥æ˜¯å¦éœ€è¦é‡ç½®ç»Ÿè®¡
            function checkDailyReset() {
                if (stats.lastReset !== new Date().toDateString()) {
                    resetDailyStats();
                    addLog('æ–°çš„ä¸€å¤©ï¼Œç»Ÿè®¡å·²é‡ç½®', 'info');
                }
            }

            // æ˜¾ç¤ºçŠ¶æ€æ¶ˆæ¯
            function showStatus(message, type) {
                elements.configStatus.textContent = message;
                elements.configStatus.className = 'status-message';
                
                if (type === 'success') {
                    elements.configStatus.classList.add('status-success');
                } else if (type === 'error') {
                    elements.configStatus.classList.add('status-error');
                } else {
                    elements.configStatus.classList.add('status-info');
                }
                
                elements.configStatus.style.display = 'block';
                
                setTimeout(() => {
                    if (type !== 'info') {
                        elements.configStatus.style.display = 'none';
                    }
                }, 5000);
            }

            // æ·»åŠ æ—¥å¿—
            function addLog(message, type = 'info') {
                const now = new Date();
                const timeString = now.toLocaleTimeString('zh-CN', { hour12: false });
                
                const logEntry = document.createElement('div');
                logEntry.className = 'log-entry';
                
                let icon = 'ğŸ“';
                if (type === 'success') icon = 'âœ…';
                if (type === 'error') icon = 'âŒ';
                if (type === 'warning') icon = 'âš ï¸';
                if (type === 'info') icon = 'â„¹ï¸';
                
                logEntry.innerHTML = `
                    <span class="log-time">${timeString}</span>
                    <span class="log-content">${icon} ${message}</span>
                `;
                
                elements.monitorLog.appendChild(logEntry);
                elements.monitorLog.scrollTop = elements.monitorLog.scrollHeight;
                
                // ä¿æŒæ—¥å¿—æ•°é‡ä¸è¶…è¿‡200æ¡
                const logEntries = elements.monitorLog.querySelectorAll('.log-entry');
                if (logEntries.length > 200) {
                    for (let i = 0; i < logEntries.length - 200; i++) {
                        logEntries[i].remove();
                    }
                }
            }

            // ç›‘å¬æ¥è‡ªITDOGé¡µé¢çš„æ¶ˆæ¯
            window.addEventListener('message', function(event) {
                console.log('æ”¶åˆ°æ¶ˆæ¯:', event.data);
                
                if (event.data && event.data.type === 'ITDOG_TEST_RESULT') {
                    const data = event.data;
                    const domain = data.domain;
                    const rate = data.connectivityRate || 0;
                    const isLowRate = data.isLowRate;
                    
                    // æŸ¥æ‰¾åŸŸåç´¢å¼•
                    let domainIndex = -1;
                    for (let i = 0; i < domainArray.length; i++) {
                        if (domainArray[i] === domain || domain.includes(domainArray[i])) {
                            domainIndex = i;
                            break;
                        }
                    }
                    
                    if (domainIndex !== -1 && domainStatus[domainIndex]) {
                        // æ£€æŸ¥æ ‡ç­¾é¡µæ˜¯å¦å·²å¤„ç†è¿‡
                        const tabInfo = activeTabs.get(domainIndex);
                        if (tabInfo && tabInfo.checked) {
                            return; // å·²ç»å¤„ç†è¿‡ï¼Œé¿å…é‡å¤å¤„ç†
                        }
                        
                        // æ ‡è®°ä¸ºå·²å¤„ç†
                        if (tabInfo) {
                            tabInfo.checked = true;
                        }
                        
                        // æ›´æ–°åŸŸåçŠ¶æ€
                        const status = isLowRate ? 'lowrate' : 'success';
                        updateDomainStatus(domainIndex, status, rate);
                        
                        // ä»æ´»è·ƒæ ‡ç­¾é¡µä¸­ç§»é™¤
                        activeTabs.delete(domainIndex);
                        
                        // æ›´æ–°è¿›åº¦
                        updateProgress();
                        
                        // è®°å½•æ—¥å¿—
                        if (isLowRate) {
                            addLog(`âš ï¸ ${domain} - è¿é€šç‡: ${rate}% (ä½äº90%)`, 'warning');
                            
                            // å‘é€Telegramé€šçŸ¥
                            sendLowRateNotification(domain, data)
                                .then(success => {
                                    if (success) {
                                        addLog(`ğŸ“¤ Telegramé€šçŸ¥å·²å‘é€: ${domain}`, 'success');
                                    }
                                });
                        } else {
                            addLog(`âœ… ${domain} - è¿é€šç‡: ${rate}%`, 'success');
                        }
                        
                        // æ£€æŸ¥æµ‹è¯•æ˜¯å¦å®Œæˆ
                        checkTestCompletion();
                    }
                }
            });

            // äº‹ä»¶ç›‘å¬
            elements.saveConfigBtn.addEventListener('click', saveConfig);
            elements.testConfigBtn.addEventListener('click', testConfig);
            elements.getChatIdBtn.addEventListener('click', getChatId);
            elements.clearConfigBtn.addEventListener('click', clearConfig);
            elements.startTestBtn.addEventListener('click', startBatchTest);
            elements.clearDomainsBtn.addEventListener('click', () => {
                elements.domains.value = '';
                saveDomains();
                showStatus('åŸŸååˆ—è¡¨å·²æ¸…ç©º', 'info');
                addLog('åŸŸååˆ—è¡¨å·²æ¸…ç©º', 'info');
            });
            elements.loadDefaultDomainsBtn.addEventListener('click', loadDefaultDomains);
            elements.testSelectedBtn.addEventListener('click', startBatchTest);
            elements.pauseBtn.addEventListener('click', pauseTest);
            elements.stopBtn.addEventListener('click', stopTest);
            
            // åœ°åŒºè®¾ç½®æ›´æ”¹ç›‘å¬
            elements.regionMainland.addEventListener('change', saveRegionSettings);
            elements.regionTW.addEventListener('change', saveRegionSettings);
            elements.regionHK.addEventListener('change', saveRegionSettings);
            elements.regionMO.addEventListener('change', saveRegionSettings);
            elements.regionOverseas.addEventListener('change', saveRegionSettings);
            
            // é«˜çº§è®¾ç½®æ›´æ”¹ç›‘å¬
            elements.autoFillDomains.addEventListener('change', saveAdvancedSettings);
            elements.waitForPageLoad.addEventListener('change', saveAdvancedSettings);
            elements.autoRetry.addEventListener('change', saveAdvancedSettings);

            // åˆå§‹åŒ–
            loadConfig();
            checkDailyReset();
            
            // æ·»åŠ æ¬¢è¿æ—¥å¿—
            addLog('ITDOGç›‘æ§ç³»ç»Ÿå·²å¯åŠ¨ v6.5', 'success');
            addLog('è¯·å…ˆé…ç½®Telegramä¿¡æ¯ï¼Œç„¶åå¼€å§‹æ‰¹é‡æµ‹è¯•', 'info');
            
            console.log('ITDOGç›‘æ§ç³»ç»Ÿå·²åŠ è½½ - å®Œæ•´åŠŸèƒ½ç‰ˆ v6.5');
        });
    </script>
</body>
</html>
