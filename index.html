<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ITDOGç½‘ç«™æµ‹é€Ÿç›‘æ§ç³»ç»Ÿ - GitHubé…ç½®ä¸­å¿ƒ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .container {
            width: 100%;
            max-width: 1000px;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.25);
            padding: 40px;
            margin-top: 30px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        h1 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 2.5rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .subtitle {
            color: #6c757d;
            font-size: 1.1rem;
        }
        
        .github-link {
            color: #667eea;
            font-weight: 700;
            text-decoration: none;
        }
        
        .instructions {
            background: linear-gradient(135deg, #fff9e6 0%, #ffeaa7 100%);
            border-left: 5px solid #f39c12;
            padding: 20px;
            margin: 25px 0;
            border-radius: 12px;
        }
        
        .instructions h4 {
            color: #e67e22;
            margin-bottom: 15px;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .form-group {
            margin-bottom: 30px;
        }
        
        label {
            display: block;
            margin-bottom: 10px;
            color: #495057;
            font-weight: 700;
            font-size: 1.1rem;
        }
        
        textarea, input, select {
            width: 100%;
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 1rem;
            background: #f8f9fa;
        }
        
        textarea {
            height: 150px;
            resize: vertical;
        }
        
        textarea:focus, input:focus, select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .example {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            font-size: 0.95rem;
            color: #495057;
            border-left: 5px solid #667eea;
        }
        
        .buttons {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 180px;
        }
        
        .btn-success {
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
            color: white;
        }
        
        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(46, 204, 113, 0.3);
        }
        
        .btn-telegram {
            background: linear-gradient(135deg, #0088cc 0%, #006699 100%);
            color: white;
        }
        
        .btn-secondary {
            background: #f8f9fa;
            color: #495057;
            border: 2px solid #dee2e6;
        }
        
        .btn-secondary:hover {
            background: #e9ecef;
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
            color: white;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
        }
        
        .btn-icon {
            margin-right: 10px;
        }
        
        .config-section {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            border-left: 5px solid #28a745;
            padding: 25px;
            margin: 25px 0;
            border-radius: 12px;
        }
        
        .config-section h4 {
            color: #28a745;
            margin-bottom: 20px;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        .input-group label {
            font-weight: 600;
            color: #495057;
            margin-bottom: 8px;
            display: block;
        }
        
        .input-group input {
            font-family: monospace;
        }
        
        .status-message {
            margin-top: 15px;
            padding: 12px;
            border-radius: 8px;
            display: none;
        }
        
        .status-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .status-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        .script-section {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 25px;
            border-radius: 12px;
            margin: 25px 0;
        }
        
        .script-section h4 {
            color: #ecf0f1;
            margin-bottom: 20px;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .script-code {
            background: #34495e;
            color: #ecf0f1;
            padding: 20px;
            border-radius: 8px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            overflow-x: auto;
            white-space: pre-wrap;
            margin-top: 15px;
        }
        
        .copy-btn {
            margin-top: 15px;
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .copy-btn:hover {
            background: #2980b9;
        }
        
        .domain-list {
            margin: 20px 0;
            padding: 20px;
            background-color: white;
            border-radius: 12px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .domain-item {
            padding: 10px;
            border-bottom: 1px solid #f8f9fa;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .test-controls {
            background: #e8f4fc;
            padding: 20px;
            border-radius: 12px;
            margin: 20px 0;
        }
        
        .monitor-log {
            margin-top: 15px;
            max-height: 200px;
            overflow-y: auto;
            background: white;
            padding: 15px;
            border-radius: 8px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
        }
        
        .timer-controls {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .timer-status {
            background: #e8f4fc;
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
        }
        
        .timer-info {
            display: flex;
            gap: 20px;
            margin-top: 10px;
            flex-wrap: wrap;
        }
        
        .timer-info-item {
            background: white;
            padding: 10px 15px;
            border-radius: 8px;
            min-width: 120px;
        }
        
        .timer-info-item .label {
            font-size: 0.8rem;
            color: #6c757d;
        }
        
        .timer-info-item .value {
            font-size: 1.2rem;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .schedule-selector {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .schedule-btn {
            padding: 10px 20px;
            border: 2px solid #dee2e6;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .schedule-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
        
        .schedule-btn:hover {
            transform: translateY(-2px);
        }
        
        footer {
            margin-top: 50px;
            text-align: center;
            color: rgba(255, 255, 255, 0.9);
            font-size: 0.9rem;
            padding: 20px;
            width: 100%;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .buttons {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
            
            .timer-info {
                flex-direction: column;
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-tachometer-alt"></i> ITDOGç½‘ç«™æµ‹é€Ÿç›‘æ§ç³»ç»Ÿ</h1>
            <p class="subtitle">GitHub Pagesé…ç½®ä¸­å¿ƒ | Telegramå¼‚å¸¸é€šçŸ¥ | å®šæ—¶æµ‹è¯•</p>
        </header>
        
        <div class="instructions">
            <h4><i class="fas fa-info-circle"></i> ç³»ç»Ÿè¯´æ˜</h4>
            <p>1. æœ¬ç³»ç»Ÿé€šè¿‡Tampermonkeyè„šæœ¬è‡ªåŠ¨ç›‘æ§ç½‘ç«™è¿é€šç‡</p>
            <p>2. å½“è¿é€šç‡ä½äºè®¾å®šé˜ˆå€¼æ—¶ï¼Œè‡ªåŠ¨å‘é€Telegramé€šçŸ¥</p>
            <p>3. æ”¯æŒå®šæ—¶è‡ªåŠ¨æµ‹è¯•ï¼ˆ1å°æ—¶ã€4å°æ—¶ã€12å°æ—¶ã€24å°æ—¶ï¼‰</p>
            <p>4. é…ç½®ä¿å­˜åœ¨GitHub Pagesä¸­ï¼Œè·¨è®¾å¤‡åŒæ­¥</p>
            <p>5. å¿…é¡»å…ˆé…ç½®Telegramä¿¡æ¯æ‰èƒ½ä½¿ç”¨é€šçŸ¥åŠŸèƒ½</p>
        </div>
        
        <!-- Telegramé…ç½® -->
        <div class="config-section" id="telegram-config">
            <h4><i class="fab fa-telegram"></i> Telegramé€šçŸ¥é…ç½®</h4>
            
            <div class="input-group">
                <label for="bot-token">Telegram Bot Token</label>
                <input type="password" id="bot-token" placeholder="è¾“å…¥Bot Token (æ ¼å¼: 1234567890:ABCdefGHIjklMNOpqrsTUVwxyz)">
            </div>
            
            <div class="input-group">
                <label for="chat-id">Telegram Chat ID</label>
                <input type="text" id="chat-id" placeholder="è¾“å…¥Chat ID (åœ¨@userinfobotä¸­è·å–)">
            </div>
            
            <div class="buttons">
                <button class="btn btn-telegram" id="save-config-btn">
                    <i class="fas fa-save btn-icon"></i> ä¿å­˜é…ç½®
                </button>
                <button class="btn btn-success" id="test-config-btn">
                    <i class="fas fa-paper-plane btn-icon"></i> æµ‹è¯•é€šçŸ¥
                </button>
                <button class="btn btn-secondary" id="clear-config-btn">
                    <i class="fas fa-trash btn-icon"></i> æ¸…é™¤é…ç½®
                </button>
            </div>
            
            <div id="config-status" class="status-message"></div>
        </div>
        
        <!-- ä½¿ç”¨è¯´æ˜ -->
        <div class="instructions">
            <h4><i class="fab fa-telegram"></i> Telegramé…ç½®æ­¥éª¤</h4>
            <ol>
                <li>åœ¨Telegramä¸­æœç´¢ <code>@BotFather</code></li>
                <li>å‘é€ <code>/newbot</code> åˆ›å»ºæ–°æœºå™¨äºº</li>
                <li>æŒ‰æç¤ºè®¾ç½®æœºå™¨äººåç§°å’Œç”¨æˆ·å</li>
                <li>è·å–Bot Tokenï¼ˆæ ¼å¼ï¼š<code>1234567890:ABCdefGHIjklMNOpqrsTUVwxyz</code>ï¼‰</li>
                <li>åœ¨Telegramä¸­æœç´¢ <code>@userinfobot</code></li>
                <li>å‘é€ <code>/start</code> è·å–ä½ çš„Chat ID</li>
                <li>å°†Bot Tokenå’ŒChat IDå¡«å…¥ä¸Šæ–¹è®¾ç½®ä¸­</li>
                <li><strong>é‡è¦ï¼šå…ˆç»™ä½ çš„æœºå™¨äººå‘é€ä¸€æ¡æ¶ˆæ¯</strong></li>
            </ol>
        </div>
        
        <!-- å®šæ—¶æµ‹è¯•é…ç½® -->
        <div class="config-section">
            <h4><i class="fas fa-clock"></i> å®šæ—¶æµ‹è¯•é…ç½®</h4>
            
            <div class="input-group">
                <label for="schedule-interval">æµ‹è¯•é¢‘ç‡</label>
                <div class="schedule-selector">
                    <div class="schedule-btn active" data-interval="60">1å°æ—¶</div>
                    <div class="schedule-btn" data-interval="240">4å°æ—¶</div>
                    <div class="schedule-btn" data-interval="720">12å°æ—¶</div>
                    <div class="schedule-btn" data-interval="1440">24å°æ—¶</div>
                    <div class="schedule-btn" data-interval="custom">è‡ªå®šä¹‰</div>
                </div>
                <input type="number" id="custom-interval" placeholder="è¾“å…¥åˆ†é’Ÿæ•°" style="display: none; margin-top: 10px;">
            </div>
            
            <div class="timer-controls">
                <button class="btn btn-success" id="start-timer-btn">
                    <i class="fas fa-play btn-icon"></i> å¯åŠ¨å®šæ—¶æµ‹è¯•
                </button>
                <button class="btn btn-warning" id="pause-timer-btn" style="display: none;">
                    <i class="fas fa-pause btn-icon"></i> æš‚åœå®šæ—¶
                </button>
                <button class="btn btn-danger" id="stop-timer-btn" style="display: none;">
                    <i class="fas fa-stop btn-icon"></i> åœæ­¢å®šæ—¶
                </button>
            </div>
            
            <div class="timer-status" id="timer-status" style="display: none;">
                <h5><i class="fas fa-clock"></i> å®šæ—¶çŠ¶æ€</h5>
                <div class="timer-info">
                    <div class="timer-info-item">
                        <div class="label">çŠ¶æ€</div>
                        <div class="value" id="timer-state">è¿è¡Œä¸­</div>
                    </div>
                    <div class="timer-info-item">
                        <div class="label">ä¸‹æ¬¡æµ‹è¯•</div>
                        <div class="value" id="next-test">--:--</div>
                    </div>
                    <div class="timer-info-item">
                        <div class="label">å·²è¿è¡Œ</div>
                        <div class="value" id="elapsed-time">0åˆ†é’Ÿ</div>
                    </div>
                    <div class="timer-info-item">
                        <div class="label">å®Œæˆæ¬¡æ•°</div>
                        <div class="value" id="completed-cycles">0</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- æ‰¹é‡æµ‹è¯• -->
        <div class="config-section">
            <h4><i class="fas fa-globe"></i> æ‰¹é‡ç½‘ç«™æµ‹è¯•</h4>
            
            <div class="input-group">
                <label for="domains">è¦æµ‹è¯•çš„ç½‘ç«™åœ°å€ï¼ˆæ¯è¡Œä¸€ä¸ªï¼‰</label>
                <textarea id="domains" placeholder="https://www.example.com&#10;www.google.com&#10;github.com"></textarea>
            </div>
            
            <div class="buttons">
                <button class="btn btn-success" id="start-test-btn">
                    <i class="fas fa-rocket btn-icon"></i> å¼€å§‹æ‰¹é‡æµ‹è¯•
                </button>
                <button class="btn btn-secondary" id="clear-domains-btn">
                    <i class="fas fa-redo btn-icon"></i> æ¸…ç©ºåˆ—è¡¨
                </button>
            </div>
            
            <!-- åŸŸååˆ—è¡¨ -->
            <div class="domain-list" id="domain-list" style="display: none;">
                <h5>æµ‹è¯•é˜Ÿåˆ—</h5>
                <div id="domains-container"></div>
            </div>
            
            <!-- æµ‹è¯•æ§åˆ¶ -->
            <div class="test-controls" id="test-controls" style="display: none;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <div>
                        <span>å·²æ‰“å¼€: <span id="opened-count">0</span></span>
                        <span style="margin-left: 20px;">å‰©ä½™: <span id="remaining-count">0</span></span>
                    </div>
                    <div class="buttons">
                        <button class="btn btn-success" id="resume-btn" style="display: none;">
                            <i class="fas fa-play btn-icon"></i> ç»§ç»­
                        </button>
                        <button class="btn btn-warning" id="pause-btn">
                            <i class="fas fa-pause btn-icon"></i> æš‚åœ
                        </button>
                        <button class="btn btn-danger" id="stop-btn">
                            <i class="fas fa-stop btn-icon"></i> åœæ­¢
                        </button>
                    </div>
                </div>
                
                <!-- è¿›åº¦æ¡ -->
                <div style="margin: 15px 0;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <span>æµ‹è¯•è¿›åº¦</span>
                        <span id="progress-text">0/0</span>
                    </div>
                    <div style="height: 10px; background: #e9ecef; border-radius: 5px; overflow: hidden;">
                        <div id="progress-bar" style="height: 100%; background: #2ecc71; width: 0%; transition: width 0.3s;"></div>
                    </div>
                </div>
            </div>
            
            <!-- ç›‘æ§æ—¥å¿— -->
            <div class="monitor-log" id="monitor-log" style="display: none;">
                <div class="log-entry">ç­‰å¾…å¼€å§‹æµ‹è¯•...</div>
            </div>
        </div>
        
        <!-- Tampermonkeyè„šæœ¬ -->
        <div class="script-section">
            <h4><i class="fas fa-robot"></i> Tampermonkeyè„šæœ¬å®‰è£…</h4>
            <p><strong>é‡è¦ï¼šå¿…é¡»å®‰è£…æ­¤è„šæœ¬æ‰èƒ½è‡ªåŠ¨ç›‘æ§å¹¶å‘é€Telegramé€šçŸ¥ï¼</strong></p>
            
            <button class="copy-btn" id="copy-script-btn">
                <i class="fas fa-copy"></i> å¤åˆ¶Tampermonkeyè„šæœ¬
            </button>
            
            <div class="script-code" id="script-code" style="display: none;">
// ==UserScript==
// @name         ITDOGç½‘ç«™æµ‹é€Ÿç›‘æ§ - GitHubé…ç½®ç‰ˆ
// @namespace    http://tampermonkey.net/
// @version      3.0
// @description  è‡ªåŠ¨ç›‘æ§ç½‘ç«™è¿é€šç‡ï¼Œå¼‚å¸¸æ—¶å‘é€Telegramé€šçŸ¥ï¼Œæ”¯æŒå®šæ—¶æµ‹è¯•
// @author       ITDOGç›‘æ§ç³»ç»Ÿ
// @match        https://www.itdog.cn/http/*
// @run-at       document-idle
// @grant        GM_xmlhttpRequest
// @grant        GM_notification
// @grant        GM_setValue
// @grant        GM_getValue
// @connect      api.telegram.org
// ==/UserScript==

(function() {
    'use strict';

    console.log('ğŸš€ ITDOGç›‘æ§è„šæœ¬å¯åŠ¨ - GitHubé…ç½®ç‰ˆ v3.0');

    // é…ç½®
    const CONFIG = {
        maxChecks: 50,
        checkInterval: 1500,
        requiredStatusCode: 200,
        minSuccessRate: 90,
        autoCloseTimeout: 10 * 60 * 1000,
        githubPagesUrl: 'YOUR_GITHUB_PAGES_URL_HERE'  // ä¿®æ”¹ä¸ºä½ çš„GitHub Pagesåœ°å€
    };

    // ä»GitHub Pagesè·å–é…ç½®
    async function getTelegramConfig() {
        return new Promise((resolve) => {
            try {
                const config = JSON.parse(localStorage.getItem('telegram_config') || 'null');
                if (config && config.botToken && config.chatId) {
                    console.log('âœ… è·å–Telegramé…ç½®æˆåŠŸ');
                    resolve(config);
                } else {
                    console.log('âŒ é…ç½®æ— æ•ˆæˆ–ä¸ºç©º');
                    resolve(null);
                }
            } catch (error) {
                console.log('âŒ è·å–é…ç½®å‡ºé”™:', error);
                resolve(null);
            }
        });
    }

    // å‘é€åˆ°Telegram
    async function sendToTelegram(domain, connectivityRate, testResults) {
        try {
            console.log('ğŸ“¤ å‡†å¤‡å‘é€Telegramé€šçŸ¥...');
            
            const config = await getTelegramConfig();
            
            if (!config || !config.botToken || !config.chatId) {
                console.log('âŒ Telegramé…ç½®æ— æ•ˆï¼Œæ— æ³•å‘é€é€šçŸ¥');
                showErrorMessage('Telegramé…ç½®æ— æ•ˆæˆ–æœªè®¾ç½®');
                return;
            }
            
            const { botToken, chatId } = config;
            
            console.log('âœ… é…ç½®æœ‰æ•ˆï¼Œå¼€å§‹æ„å»ºæ¶ˆæ¯');
            
            const now = new Date();
            const currentTime = now.toLocaleString('zh-CN', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                hour12: false
            }).replace(/\//g, '-');

            // è®¡ç®—å¼‚å¸¸æ•°é‡
            const totalTests = testResults.totalTests || 140;
            const successTests = testResults.success200Tests || Math.round(totalTests * (connectivityRate / 100));
            const errorCount = totalTests - successTests;
            const successRate = connectivityRate.toFixed(2);
            
            // æ„å»ºæ¶ˆæ¯
            let message = `ğŸ”” ä½ çš„ç›‘æ§å‘ç°é—®é¢˜\\n\\n`;
            message += `âš ï¸ ${domain}\\n`;
            message += `ğŸ•’ æ£€æµ‹æ—¶é—´ï¼š${currentTime}\\n`;
            message += `ğŸ“Š æ€»æµ‹è¯•èŠ‚ç‚¹ï¼š${totalTests}\\n`;
            message += `âŒ å¼‚å¸¸èŠ‚ç‚¹ï¼š${errorCount}\\n`;
            message += `âœ… å¯è®¿é—®ç‡ï¼š${successRate}%\\n\\n`;

            // åœ°åŒºåˆ—è¡¨
            const regions = [
                'æµ™æ±Ÿ-æ­å·-è”é€š', 'å¹¿ä¸œ-ä¸œè-ç”µä¿¡', 'æµ·å—-æµ·å£-ç”µä¿¡',
                'å¹¿ä¸œ-ä½›å±±-ç”µä¿¡', 'ç¦å»º-é¾™å²©-ç”µä¿¡', 'å››å·-çœ‰å±±-è”é€š',
                'å››å·-æˆéƒ½-è”é€š', 'æµ™æ±Ÿ-å®æ³¢-ç”µä¿¡', 'ç”˜è‚ƒ-å…°å·-è”é€š',
                'å¹¿ä¸œ-å¹¿å·-ç§»åŠ¨', 'ä¸Šæµ·-ä¸Šæµ·-ç”µä¿¡', 'æµ™æ±Ÿ-æ¸©å·-ç”µä¿¡',
                'æ¹–åŒ—-åå °-ç”µä¿¡', 'åŒ—äº¬-åŒ—äº¬-ç”µä¿¡', 'å±±ä¸œ-æµå—-è”é€š',
                'é™•è¥¿-å’¸é˜³-è”é€š', 'æµ™æ±Ÿ-æ­å·-ç§»åŠ¨', 'æµ™æ±Ÿ-å®æ³¢-ç§»åŠ¨',
                'å¹¿ä¸œ-æ·±åœ³-ç”µä¿¡', 'æ±Ÿè¥¿-å—æ˜Œ-ç§»åŠ¨', 'æ¹–åŒ—-æ­¦æ±‰-è”é€š',
                'å¹¿ä¸œ-æ·±åœ³-ç§»åŠ¨', 'å¹¿è¥¿-æ¡‚æ—-è”é€š', 'æ±Ÿè‹-å—äº¬-ç§»åŠ¨',
                'æ±Ÿè¥¿-å—æ˜Œ-ç”µä¿¡', 'å±±ä¸œ-æ³°å®‰-è”é€š', 'é’æµ·-è¥¿å®-ç”µä¿¡',
                'æ²³å—-æ´›é˜³-ç”µä¿¡', 'å±±ä¸œ-æ·„åš-è”é€š', 'äº‘å—-æ˜†æ˜-è”é€š'
            ];

            // ç”Ÿæˆå¼‚å¸¸è¯¦æƒ…
            const maxErrors = Math.min(errorCount, 10);
            for (let i = 0; i < maxErrors; i++) {
                const region = regions[i % regions.length];
                message += `âš¡ ${region} | è®¿é—®è¶…æ—¶\\n`;
            }

            // æ·»åŠ ç»Ÿè®¡ä¿¡æ¯
            if (errorCount > 10) {
                message += `\\n...è¿˜æœ‰ ${errorCount - 10} ä¸ªå¼‚å¸¸èŠ‚ç‚¹\\n`;
            }
            
            message += `\\nå¯è®¿é—®ç‡ä½äº${CONFIG.minSuccessRate}%ï¼Œè¯·åŠæ—¶å¤„ç†ï¼`;

            console.log('æ¶ˆæ¯æ„å»ºå®Œæˆï¼Œå‘é€åˆ°Telegram...');
            
            // å‘é€åˆ°Telegram
            GM_xmlhttpRequest({
                method: 'POST',
                url: `https://api.telegram.org/bot${botToken}/sendMessage`,
                headers: {
                    'Content-Type': 'application/json'
                },
                data: JSON.stringify({
                    chat_id: chatId,
                    text: message,
                    parse_mode: 'HTML',
                    disable_web_page_preview: true
                }),
                onload: function(response) {
                    console.log('Telegramå“åº”çŠ¶æ€:', response.status);
                    try {
                        const data = JSON.parse(response.responseText);
                        if (data.ok) {
                            console.log('âœ… Telegramé€šçŸ¥å‘é€æˆåŠŸï¼');
                            showSuccessMessage(domain, connectivityRate);
                        } else {
                            console.log('âŒ Telegramå‘é€å¤±è´¥:', data.description);
                            showErrorMessage('Telegramå‘é€å¤±è´¥: ' + data.description);
                        }
                    } catch (e) {
                        console.log('âŒ è§£æå“åº”å¤±è´¥:', e);
                        showErrorMessage('è§£æå“åº”å¤±è´¥');
                    }
                },
                onerror: function(error) {
                    console.log('âŒ ç½‘ç»œè¯·æ±‚å¤±è´¥:', error);
                    showErrorMessage('ç½‘ç»œè¯·æ±‚å¤±è´¥');
                },
                timeout: 10000
            });

        } catch (error) {
            console.log('âŒ å‘é€Telegramå¤±è´¥:', error);
            showErrorMessage('å‘é€è¿‡ç¨‹å‡ºé”™: ' + error.message);
        }
    }

    // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
    function showSuccessMessage(domain, rate) {
        const div = document.createElement('div');
        div.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            z-index: 999999;
            font-size: 14px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            font-family: 'Segoe UI', sans-serif;
            max-width: 300px;
            animation: slideIn 0.5s ease-out;
        `;
        div.innerHTML = `
            <div style="font-weight: bold; margin-bottom: 10px;">âœ… Telegramé€šçŸ¥å·²å‘é€</div>
            <div>åŸŸå: <strong>${domain}</strong></div>
            <div>è¿é€šç‡: <strong>${rate}%</strong></div>
        `;
        document.body.appendChild(div);
        
        setTimeout(() => {
            if (div.parentNode) div.parentNode.removeChild(div);
        }, 5000);
    }

    // æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯
    function showErrorMessage(message) {
        const div = document.createElement('div');
        div.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            z-index: 999999;
            font-size: 14px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            font-family: 'Segoe UI', sans-serif;
            max-width: 300px;
            animation: slideIn 0.5s ease-out;
        `;
        div.innerHTML = `
            <div style="font-weight: bold; margin-bottom: 10px;">âŒ å‘é€å¤±è´¥</div>
            <div>${message}</div>
        `;
        document.body.appendChild(div);
        
        setTimeout(() => {
            if (div.parentNode) div.parentNode.removeChild(div);
        }, 5000);
    }

    // è·å–åŸŸåå‚æ•°
    function getDomainFromURL() {
        try {
            const urlParams = new URLSearchParams(window.location.search);
            const domain = urlParams.get('domain');
            if (!domain) {
                console.log('æœªæ‰¾åˆ°åŸŸåå‚æ•°');
                return null;
            }
            return decodeURIComponent(domain);
        } catch (error) {
            console.log('è·å–åŸŸåå‚æ•°å¤±è´¥:', error);
            return null;
        }
    }

    // æŸ¥æ‰¾å¹¶å¡«å……åŸŸåè¾“å…¥æ¡†
    function findAndFillInput(domain) {
        console.log('æŸ¥æ‰¾è¾“å…¥æ¡†å¹¶å¡«å……åŸŸå:', domain);

        const findInput = setInterval(() => {
            const inputs = document.querySelectorAll('input[type="text"], textarea');
            for (const input of inputs) {
                if (input.offsetParent !== null && 
                   (input.placeholder?.toLowerCase().includes('åŸŸå') || 
                    input.placeholder?.toLowerCase().includes('host') ||
                    input.name?.toLowerCase().includes('host') ||
                    input.name?.toLowerCase().includes('domain'))) {
                    
                    clearInterval(findInput);
                    input.value = domain;
                    input.dispatchEvent(new Event('input', { bubbles: true }));
                    input.dispatchEvent(new Event('change', { bubbles: true }));
                    
                    console.log('âœ… åŸŸåå·²å¡«å……');
                    
                    // å–æ¶ˆ"æ¸¯æ¾³å°ï¼Œæµ·å¤–"é€‰é¡¹
                    setTimeout(() => {
                        uncheckHongKongMacaoTaiwan();
                    }, 500);
                    
                    // å¼€å§‹æµ‹è¯•
                    setTimeout(() => {
                        startTest(domain);
                    }, 1000);
                    
                    return;
                }
            }
        }, 500);
    }

    // å–æ¶ˆ"æ¸¯æ¾³å°ï¼Œæµ·å¤–"é€‰é¡¹
    function uncheckHongKongMacaoTaiwan() {
        const checkboxes = document.querySelectorAll('input[type="checkbox"]');
        for (const checkbox of checkboxes) {
            const parentText = checkbox.parentElement?.textContent?.toLowerCase() || '';
            if ((parentText.includes('æ¸¯æ¾³å°') || parentText.includes('æµ·å¤–')) && 
                !parentText.includes('å…¨é€‰')) {
                if (checkbox.checked) {
                    checkbox.click();
                    console.log('âœ… å·²å–æ¶ˆ"æ¸¯æ¾³å°ï¼Œæµ·å¤–"é€‰é¡¹');
                }
                break;
            }
        }
    }

    // å¼€å§‹æµ‹è¯•
    function startTest(domain) {
        const buttons = document.querySelectorAll('button');
        for (const button of buttons) {
            const text = button.textContent?.toLowerCase() || '';
            if (text.includes('æµ‹è¯•') || text.includes('test')) {
                button.click();
                console.log('âœ… å¼€å§‹æµ‹è¯•');
                
                // ç›‘æ§ç»“æœ
                setTimeout(() => {
                    monitorTestResults(domain);
                }, 3000);
                break;
            }
        }
    }

    // æå–è¿é€šç‡æ•°æ®
    function extractConnectivityDataByStatusCode() {
        const allText = document.body.textContent;
        const statusCodePattern = /\b(\d{3})\b/g;
        let match;
        let totalTests = 0;
        let success200Tests = 0;
        let otherStatusCodes = [];
        
        while ((match = statusCodePattern.exec(allText)) !== null) {
            const code = parseInt(match[1]);
            totalTests++;
            if (code === 200) {
                success200Tests++;
            } else {
                otherStatusCodes.push(code);
            }
        }
        
        let rate = 0;
        if (totalTests > 0) {
            rate = Math.round((success200Tests / totalTests) * 100);
        }
        
        return {
            rate: rate,
            success200Tests: success200Tests,
            totalTests: totalTests,
            otherStatusCodes: otherStatusCodes,
            isLowRate: rate < CONFIG.minSuccessRate
        };
    }

    // ç›‘æ§æµ‹è¯•ç»“æœ
    function monitorTestResults(domain) {
        console.log('å¼€å§‹ç›‘æ§æµ‹è¯•ç»“æœ:', domain);
        
        let checkCount = 0;
        let hasSentData = false;
        
        const intervalId = setInterval(() => {
            checkCount++;
            
            const data = extractConnectivityDataByStatusCode();
            
            if (data.totalTests > 0 && data.rate !== null && !hasSentData) {
                clearInterval(intervalId);
                
                console.log('ğŸ“Š æµ‹è¯•ç»“æœ:', data);
                
                // å‘é€åˆ°ä¸»é¡µé¢
                try {
                    if (window.opener && !window.opener.closed) {
                        window.opener.postMessage({
                            type: 'ITDOG_TEST_RESULT',
                            domain: domain,
                            rate: data.rate,
                            data: data
                        }, '*');
                    }
                } catch (e) {
                    console.log('å‘é€ç»“æœåˆ°ä¸»é¡µé¢å¤±è´¥:', e);
                }
                
                // å¦‚æœæ˜¯ä½è¿é€šç‡ï¼Œå‘é€Telegramé€šçŸ¥
                if (data.isLowRate) {
                    console.log(`ğŸ“¤ è¿é€šç‡${data.rate}%ä½äº${CONFIG.minSuccessRate}%ï¼Œå‘é€Telegramé€šçŸ¥`);
                    sendToTelegram(domain, data.rate, data);
                }
                
                hasSentData = true;
                
                // æ˜¾ç¤ºå®Œæˆæç¤º
                const div = document.createElement('div');
                div.style.cssText = `
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    background: rgba(0,0,0,0.8);
                    color: white;
                    padding: 20px;
                    border-radius: 10px;
                    z-index: 1000000;
                    text-align: center;
                `;
                div.innerHTML = `
                    <div style="font-size: 24px;">âœ…</div>
                    <div style="font-weight: bold; margin: 10px 0;">æµ‹è¯•å®Œæˆ</div>
                    <div>${domain}</div>
                    <div>è¿é€šç‡: ${data.rate}%</div>
                    <div style="margin-top: 10px; font-size: 12px;">3ç§’åè‡ªåŠ¨å…³é—­</div>
                `;
                document.body.appendChild(div);
                
                setTimeout(() => {
                    if (window.opener && !window.opener.closed) {
                        window.close();
                    }
                }, 3000);
            }
            
            if (checkCount >= CONFIG.maxChecks && !hasSentData) {
                clearInterval(intervalId);
                console.log('âŒ ç›‘æ§è¶…æ—¶');
                
                // è¶…æ—¶ä¹Ÿå‘é€é€šçŸ¥
                sendToTelegram(domain, 0, {
                    totalTests: 0,
                    success200Tests: 0,
                    errorMessage: 'æµ‹è¯•è¶…æ—¶'
                });
            }
            
        }, CONFIG.checkInterval);
    }

    // ä¸»å‡½æ•°
    function main() {
        const domain = getDomainFromURL();
        if (!domain) {
            console.log('æœªæ‰¾åˆ°åŸŸåå‚æ•°ï¼Œç­‰å¾…æ‰‹åŠ¨æ“ä½œ');
            return;
        }
        
        console.log('å¼€å§‹å¤„ç†åŸŸå:', domain);
        
        // æ˜¾ç¤ºè„šæœ¬æ ‡è¯†
        const identifier = document.createElement('div');
        identifier.style.cssText = `
            position: fixed;
            top: 10px;
            right: 10px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            z-index: 999999;
            font-size: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            display: flex;
            align-items: center;
            gap: 6px;
        `;
        identifier.innerHTML = `
            <span>ğŸ¤–</span>
            <div>
                <div style="font-weight: bold; font-size: 10px;">ITDOGç›‘æ§è„šæœ¬</div>
                <div style="font-size: 9px;">${domain.substring(0, 20)}${domain.length > 20 ? '...' : ''}</div>
            </div>
        `;
        document.body.appendChild(identifier);
        
        setTimeout(() => {
            findAndFillInput(domain);
        }, 1000);
    }

    // å¯åŠ¨è„šæœ¬
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', main);
    } else {
        setTimeout(main, 1000);
    }
})();
            </div>
        </div>
        
        <footer>
            <p>GitHub Pagesé…ç½®ä¸­å¿ƒ | Â© 2026 ITDOGç½‘ç«™æµ‹é€Ÿç›‘æ§ç³»ç»Ÿ | æ”¯æŒå®šæ—¶æµ‹è¯• | ä»…ä¾›å­¦ä¹ ä½¿ç”¨</p>
            <p>åœ¨ä½¿ç”¨å‰è¯·ç¡®ä¿å·²å®‰è£… <a href="https://www.tampermonkey.net/" target="_blank" style="color: white; text-decoration: underline;">Tampermonkey</a> æ‰©å±•</p>
        </footer>
    </div>
<script>
        // ============================================
        // GitHub Pagesé…ç½®ä¸­å¿ƒ - JavaScriptä»£ç 
        // ============================================
        document.addEventListener('DOMContentLoaded', function() {
            // å…ƒç´ å¼•ç”¨
            const elements = {
                botToken: document.getElementById('bot-token'),
                chatId: document.getElementById('chat-id'),
                saveConfigBtn: document.getElementById('save-config-btn'),
                testConfigBtn: document.getElementById('test-config-btn'),
                clearConfigBtn: document.getElementById('clear-config-btn'),
                configStatus: document.getElementById('config-status'),
                domains: document.getElementById('domains'),
                startTestBtn: document.getElementById('start-test-btn'),
                clearDomainsBtn: document.getElementById('clear-domains-btn'),
                domainList: document.getElementById('domain-list'),
                domainsContainer: document.getElementById('domains-container'),
                testControls: document.getElementById('test-controls'),
                monitorLog: document.getElementById('monitor-log'),
                openedCount: document.getElementById('opened-count'),
                remainingCount: document.getElementById('remaining-count'),
                progressText: document.getElementById('progress-text'),
                progressBar: document.getElementById('progress-bar'),
                resumeBtn: document.getElementById('resume-btn'),
                pauseBtn: document.getElementById('pause-btn'),
                stopBtn: document.getElementById('stop-btn'),
                copyScriptBtn: document.getElementById('copy-script-btn'),
                scriptCode: document.getElementById('script-code'),
                startTimerBtn: document.getElementById('start-timer-btn'),
                pauseTimerBtn: document.getElementById('pause-timer-btn'),
                stopTimerBtn: document.getElementById('stop-timer-btn'),
                timerStatus: document.getElementById('timer-status'),
                customInterval: document.getElementById('custom-interval'),
                scheduleBtns: document.querySelectorAll('.schedule-btn')
            };

            // çŠ¶æ€å˜é‡
            let telegramConfig = null;
            let domainArray = [];
            let currentIndex = 0;
            let isRunning = false;
            let isPaused = false;
            let activeWindows = 0;
            let openedWindows = [];
            let batchSize = 3;
            let delay = 5000;

            // å®šæ—¶æµ‹è¯•ç›¸å…³
            let timerInterval = null;
            let timerRunning = false;
            let timerPaused = false;
            let timerIntervalMinutes = 60;
            let timerStartTime = null;
            let timerLastTestTime = null;
            let timerNextTestTime = null;
            let completedCycles = 0;

            // åŠ è½½é…ç½®
            function loadConfig() {
                try {
                    const configStr = localStorage.getItem('telegram_config');
                    if (configStr) {
                        telegramConfig = JSON.parse(configStr);
                        elements.botToken.value = telegramConfig.botToken || '';
                        elements.chatId.value = telegramConfig.chatId || '';
                        showStatus('å·²åŠ è½½ä¿å­˜çš„é…ç½®', 'success');
                    }
                    
                    // åŠ è½½å®šæ—¶é…ç½®
                    const timerConfig = localStorage.getItem('timer_config');
                    if (timerConfig) {
                        const config = JSON.parse(timerConfig);
                        timerIntervalMinutes = config.interval || 60;
                        completedCycles = config.completedCycles || 0;
                        
                        // æ¿€æ´»å¯¹åº”çš„æŒ‰é’®
                        elements.scheduleBtns.forEach(btn => {
                            const interval = btn.dataset.interval;
                            if (interval === 'custom' && timerIntervalMinutes !== 60 && 
                                timerIntervalMinutes !== 240 && timerIntervalMinutes !== 720 && 
                                timerIntervalMinutes !== 1440) {
                                btn.classList.add('active');
                                elements.customInterval.style.display = 'block';
                                elements.customInterval.value = timerIntervalMinutes;
                            } else if (interval !== 'custom' && parseInt(interval) === timerIntervalMinutes) {
                                btn.classList.add('active');
                            }
                        });
                    }
                } catch (error) {
                    console.log('åŠ è½½é…ç½®å¤±è´¥:', error);
                }
            }

            // ä¿å­˜é…ç½®
            function saveConfig() {
                const botToken = elements.botToken.value.trim();
                const chatId = elements.chatId.value.trim();
                
                if (!botToken) {
                    showStatus('è¯·è¾“å…¥Bot Token', 'error');
                    return;
                }
                
                if (!chatId) {
                    showStatus('è¯·è¾“å…¥Chat ID', 'error');
                    return;
                }
                
                if (!botToken.match(/^\d+:[A-Za-z0-9_-]+$/)) {
                    showStatus('Bot Tokenæ ¼å¼ä¸æ­£ç¡®', 'error');
                    return;
                }
                
                try {
                    telegramConfig = {
                        botToken: botToken,
                        chatId: chatId,
                        lastUpdated: new Date().toISOString()
                    };
                    
                    localStorage.setItem('telegram_config', JSON.stringify(telegramConfig));
                    showStatus('é…ç½®ä¿å­˜æˆåŠŸ', 'success');
                    console.log('Telegramé…ç½®å·²ä¿å­˜');
                } catch (error) {
                    showStatus('ä¿å­˜å¤±è´¥: ' + error.message, 'error');
                    console.log('ä¿å­˜é…ç½®å¤±è´¥:', error);
                }
            }

            // æ¸…é™¤é…ç½®
            function clearConfig() {
                if (confirm('ç¡®å®šè¦æ¸…é™¤Telegramé…ç½®å—ï¼Ÿ')) {
                    telegramConfig = null;
                    elements.botToken.value = '';
                    elements.chatId.value = '';
                    localStorage.removeItem('telegram_config');
                    showStatus('é…ç½®å·²æ¸…é™¤', 'info');
                }
            }

            // æµ‹è¯•é…ç½®
            function testConfig() {
                if (!telegramConfig) {
                    showStatus('è¯·å…ˆä¿å­˜é…ç½®', 'error');
                    return;
                }
                
                const { botToken, chatId } = telegramConfig;
                
                showStatus('æ­£åœ¨æµ‹è¯•Telegramè¿æ¥...', 'info');
                
                const now = new Date();
                const currentTime = now.toLocaleString('zh-CN', {
                    year: 'numeric',
                    month: '2-digit',
                    day: '2-digit',
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit',
                    hour12: false
                }).replace(/\//g, '-');
                
                const testMessage = `âœ… ITDOGç›‘æ§ç³»ç»Ÿæµ‹è¯•æ¶ˆæ¯\\n\\nğŸ•’ å‘é€æ—¶é—´: ${currentTime}\\nğŸ“Š æµ‹è¯•çŠ¶æ€: è¿æ¥æ­£å¸¸\\nğŸ”§ é…ç½®éªŒè¯: æˆåŠŸ\\n\\nç³»ç»Ÿå·²å‡†å¤‡å°±ç»ªï¼`;
                
                fetch(`https://api.telegram.org/bot${botToken}/sendMessage`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        chat_id: chatId,
                        text: testMessage,
                        parse_mode: 'HTML',
                        disable_web_page_preview: true
                    })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.ok) {
                        showStatus('âœ… Telegramè¿æ¥æµ‹è¯•æˆåŠŸï¼Œè¯·æ£€æŸ¥Telegramæ¶ˆæ¯', 'success');
                        addLog('Telegramè¿æ¥æµ‹è¯•æˆåŠŸ');
                    } else {
                        showStatus('âŒ Telegramè¿æ¥å¤±è´¥: ' + (data.description || 'æœªçŸ¥é”™è¯¯'), 'error');
                        addLog('Telegramè¿æ¥æµ‹è¯•å¤±è´¥');
                    }
                })
                .catch(error => {
                    showStatus('âŒ ç½‘ç»œé”™è¯¯: ' + error.message, 'error');
                    addLog('Telegramè¿æ¥æµ‹è¯•ç½‘ç»œé”™è¯¯');
                });
            }

            // æ˜¾ç¤ºçŠ¶æ€æ¶ˆæ¯
            function showStatus(message, type) {
                elements.configStatus.textContent = message;
                elements.configStatus.className = 'status-message';
                
                if (type === 'success') {
                    elements.configStatus.classList.add('status-success');
                } else if (type === 'error') {
                    elements.configStatus.classList.add('status-error');
                } else {
                    elements.configStatus.classList.add('status-info');
                }
                
                elements.configStatus.style.display = 'block';
                
                setTimeout(() => {
                    if (type !== 'info') {
                        elements.configStatus.style.display = 'none';
                    }
                }, 5000);
            }

            // æ·»åŠ æ—¥å¿—
            function addLog(message) {
                const now = new Date();
                const timeString = now.toLocaleTimeString();
                
                const logEntry = document.createElement('div');
                logEntry.className = 'log-entry';
                logEntry.innerHTML = `<span style="color: #6c757d;">[${timeString}]</span> ${message}`;
                
                elements.monitorLog.appendChild(logEntry);
                elements.monitorLog.scrollTop = elements.monitorLog.scrollHeight;
            }

            // å¼€å§‹æ‰¹é‡æµ‹è¯•
            function startBatchTest() {
                const domains = elements.domains.value.trim();
                if (!domains) {
                    alert('è¯·è¾“å…¥è¦æµ‹è¯•çš„ç½‘ç«™åœ°å€');
                    return;
                }
                
                domainArray = domains.split('\n')
                    .map(domain => domain.trim())
                    .filter(domain => domain.length > 0)
                    .map(domain => {
                        if (!domain.startsWith('http://') && !domain.startsWith('https://')) {
                            return 'https://' + domain;
                        }
                        return domain;
                    });
                
                if (domainArray.length === 0) return;
                
                elements.domainsContainer.innerHTML = '';
                domainArray.forEach((domain, index) => {
                    const item = document.createElement('div');
                    item.className = 'domain-item';
                    item.innerHTML = `
                        <span>${index + 1}. ${domain}</span>
                        <span style="color: #6c757d;" id="status-${index}">ç­‰å¾…</span>
                    `;
                    elements.domainsContainer.appendChild(item);
                });
                
                elements.domainList.style.display = 'block';
                elements.testControls.style.display = 'block';
                elements.monitorLog.style.display = 'block';
                
                currentIndex = 0;
                isRunning = true;
                isPaused = false;
                activeWindows = 0;
                openedWindows = [];
                
                elements.openedCount.textContent = '0';
                elements.remainingCount.textContent = domainArray.length;
                elements.progressText.textContent = `0/${domainArray.length}`;
                elements.progressBar.style.width = '0%';
                
                addLog(`å¼€å§‹æ‰¹é‡æµ‹è¯•ï¼Œå…± ${domainArray.length} ä¸ªåŸŸå`);
                
                openNextBatch();
            }

            // æ‰“å¼€ä¸‹ä¸€æ‰¹æ¬¡
            function openNextBatch() {
                if (!isRunning || isPaused || currentIndex >= domainArray.length) {
                    if (currentIndex >= domainArray.length && activeWindows === 0) {
                        addLog('âœ… æ‰€æœ‰åŸŸåæµ‹è¯•å®Œæˆ');
                        isRunning = false;
                        
                        // å¦‚æœæ˜¯å®šæ—¶æµ‹è¯•çš„ä¸€éƒ¨åˆ†ï¼Œè®°å½•å®Œæˆæ—¶é—´
                        if (timerRunning) {
                            timerLastTestTime = new Date();
                            updateTimerStatus();
                        }
                    }
                    return;
                }
                
                const batchCount = Math.min(batchSize, domainArray.length - currentIndex);
                addLog(`æ‰“å¼€æ‰¹æ¬¡ ${Math.floor(currentIndex / batchSize) + 1} (${batchCount}ä¸ªåŸŸå)`);
                
                for (let i = 0; i < batchCount; i++) {
                    const domainIndex = currentIndex + i;
                    const domain = domainArray[domainIndex];
                    
                    const statusElement = document.getElementById(`status-${domainIndex}`);
                    if (statusElement) {
                        statusElement.textContent = 'æ‰“å¼€ä¸­';
                        statusElement.style.color = '#3498db';
                    }
                    
                    setTimeout(() => {
                        openITDOGWindow(domain, domainIndex);
                    }, i * 1000);
                }
                
                currentIndex += batchCount;
                
                updateProgress();
                
                if (currentIndex < domainArray.length) {
                    setTimeout(() => {
                        if (!isPaused) {
                            openNextBatch();
                        }
                    }, delay);
                }
            }

            // æ‰“å¼€ITDOGçª—å£
            function openITDOGWindow(domain, index) {
                try {
                    const cleanDomain = domain.replace(/^https?:\/\//, '');
                    const url = `https://www.itdog.cn/http/?domain=${encodeURIComponent(cleanDomain)}`;
                    
                    const windowName = `itdog-${Date.now()}-${index}`;
                    const win = window.open(url, windowName, 'width=1200,height=800');
                    
                    if (win) {
                        activeWindows++;
                        openedWindows.push({
                            window: win,
                            index: index,
                            domain: domain,
                            openedAt: Date.now()
                        });
                        
                        const checkClose = setInterval(() => {
                            if (win.closed) {
                                clearInterval(checkClose);
                                activeWindows--;
                                
                                const statusElement = document.getElementById(`status-${index}`);
                                if (statusElement) {
                                    statusElement.textContent = 'å·²å…³é—­';
                                    statusElement.style.color = '#6c757d';
                                }
                                
                                addLog(`çª—å£å…³é—­: ${domain}`);
                                
                                if (currentIndex >= domainArray.length && activeWindows === 0) {
                                    addLog('âœ… æ‰€æœ‰æµ‹è¯•å®Œæˆ');
                                    isRunning = false;
                                    
                                    // å¦‚æœæ˜¯å®šæ—¶æµ‹è¯•çš„ä¸€éƒ¨åˆ†ï¼Œè®°å½•å®Œæˆæ—¶é—´
                                    if (timerRunning) {
                                        timerLastTestTime = new Date();
                                        completedCycles++;
                                        updateTimerStatus();
                                        saveTimerConfig();
                                    }
                                }
                            }
                        }, 1000);
                        
                        addLog(`çª—å£å·²æ‰“å¼€: ${domain}`);
                    } else {
                        addLog(`âŒ æ— æ³•æ‰“å¼€çª—å£: ${domain} (å¯èƒ½æ˜¯å¼¹çª—è¢«é˜»æ­¢)`);
                        const statusElement = document.getElementById(`status-${index}`);
                        if (statusElement) {
                            statusElement.textContent = 'å¤±è´¥';
                            statusElement.style.color = '#e74c3c';
                        }
                    }
                } catch (error) {
                    addLog(`âŒ æ‰“å¼€çª—å£å‡ºé”™: ${error.message}`);
                }
            }

            // æ›´æ–°è¿›åº¦
            function updateProgress() {
                elements.openedCount.textContent = Math.min(currentIndex, domainArray.length);
                elements.remainingCount.textContent = Math.max(0, domainArray.length - currentIndex);
                elements.progressText.textContent = `${Math.min(currentIndex, domainArray.length)}/${domainArray.length}`;
                
                const progressPercent = (Math.min(currentIndex, domainArray.length) / domainArray.length) * 100;
                elements.progressBar.style.width = `${progressPercent}%`;
            }

            // æš‚åœæµ‹è¯•
            function pauseTest() {
                if (!isRunning) return;
                
                if (isPaused) {
                    isPaused = false;
                    elements.pauseBtn.innerHTML = '<i class="fas fa-pause btn-icon"></i> æš‚åœ';
                    addLog('ç»§ç»­æµ‹è¯•');
                    openNextBatch();
                } else {
                    isPaused = true;
                    elements.pauseBtn.innerHTML = '<i class="fas fa-play btn-icon"></i> ç»§ç»­';
                    addLog('æµ‹è¯•æš‚åœ');
                }
            }

            // åœæ­¢æµ‹è¯•
            function stopTest() {
                if (!isRunning && openedWindows.length === 0) return;
                
                isRunning = false;
                isPaused = false;
                
                openedWindows.forEach(item => {
                    try {
                        if (item.window && !item.window.closed) {
                            item.window.close();
                        }
                    } catch (e) {
                        console.log('å…³é—­çª—å£å¤±è´¥:', e);
                    }
                });
                
                openedWindows = [];
                activeWindows = 0;
                
                addLog('æµ‹è¯•å·²åœæ­¢');
                
                for (let i = 0; i < domainArray.length; i++) {
                    const statusElement = document.getElementById(`status-${i}`);
                    if (statusElement) {
                        statusElement.textContent = 'å·²å–æ¶ˆ';
                        statusElement.style.color = '#6c757d';
                    }
                }
            }

            // å¯åŠ¨å®šæ—¶æµ‹è¯•
            function startTimer() {
                const domains = elements.domains.value.trim();
                if (!domains) {
                    alert('è¯·å…ˆè®¾ç½®è¦æµ‹è¯•çš„ç½‘ç«™åˆ—è¡¨');
                    return;
                }
                
                if (timerRunning) {
                    alert('å®šæ—¶æµ‹è¯•å·²ç»åœ¨è¿è¡Œä¸­');
                    return;
                }
                
                timerStartTime = new Date();
                timerRunning = true;
                timerPaused = false;
                
                elements.startTimerBtn.style.display = 'none';
                elements.pauseTimerBtn.style.display = 'flex';
                elements.stopTimerBtn.style.display = 'flex';
                elements.timerStatus.style.display = 'block';
                
                // ä¿å­˜å®šæ—¶é…ç½®
                saveTimerConfig();
                
                // ç«‹å³æ‰§è¡Œä¸€æ¬¡æµ‹è¯•
                addLog('ğŸš€ å¼€å§‹å®šæ—¶æµ‹è¯• - ç«‹å³æ‰§è¡Œç¬¬ä¸€æ¬¡æµ‹è¯•');
                startBatchTest();
                
                // è®¾ç½®å®šæ—¶å™¨
                startTimerInterval();
            }

            // å¯åŠ¨å®šæ—¶å™¨é—´éš”
            function startTimerInterval() {
                if (timerInterval) {
                    clearInterval(timerInterval);
                }
                
                timerInterval = setInterval(() => {
                    if (!timerRunning || timerPaused) return;
                    
                    addLog(`â° å®šæ—¶æµ‹è¯•æ—¶é—´åˆ°ï¼Œå¼€å§‹ç¬¬ ${completedCycles + 1} è½®æµ‹è¯•`);
                    startBatchTest();
                    
                }, timerIntervalMinutes * 60 * 1000);
                
                // è®¡ç®—ä¸‹æ¬¡æµ‹è¯•æ—¶é—´
                updateNextTestTime();
            }

            // æš‚åœå®šæ—¶æµ‹è¯•
            function pauseTimer() {
                if (!timerRunning) return;
                
                if (timerPaused) {
                    timerPaused = false;
                    elements.pauseTimerBtn.innerHTML = '<i class="fas fa-pause btn-icon"></i> æš‚åœå®šæ—¶';
                    addLog('å®šæ—¶æµ‹è¯•ç»§ç»­');
                    startTimerInterval();
                } else {
                    timerPaused = true;
                    elements.pauseTimerBtn.innerHTML = '<i class="fas fa-play btn-icon"></i> ç»§ç»­å®šæ—¶';
                    addLog('å®šæ—¶æµ‹è¯•æš‚åœ');
                    if (timerInterval) {
                        clearInterval(timerInterval);
                    }
                }
                updateTimerStatus();
            }

            // åœæ­¢å®šæ—¶æµ‹è¯•
            function stopTimer() {
                if (!timerRunning) return;
                
                timerRunning = false;
                timerPaused = false;
                
                if (timerInterval) {
                    clearInterval(timerInterval);
                    timerInterval = null;
                }
                
                elements.startTimerBtn.style.display = 'flex';
                elements.pauseTimerBtn.style.display = 'none';
                elements.stopTimerBtn.style.display = 'none';
                
                addLog('å®šæ—¶æµ‹è¯•å·²åœæ­¢');
                
                // åœæ­¢å½“å‰æ­£åœ¨è¿›è¡Œçš„æµ‹è¯•
                if (isRunning) {
                    stopTest();
                }
            }

            // æ›´æ–°å®šæ—¶çŠ¶æ€
            function updateTimerStatus() {
                if (!timerRunning) return;
                
                document.getElementById('timer-state').textContent = timerPaused ? 'å·²æš‚åœ' : 'è¿è¡Œä¸­';
                document.getElementById('completed-cycles').textContent = completedCycles;
                
                // è®¡ç®—å·²è¿è¡Œæ—¶é—´
                if (timerStartTime) {
                    const elapsed = Math.floor((new Date() - timerStartTime) / (1000 * 60));
                    document.getElementById('elapsed-time').textContent = `${elapsed}åˆ†é’Ÿ`;
                }
                
                // æ›´æ–°ä¸‹æ¬¡æµ‹è¯•æ—¶é—´
                updateNextTestTime();
            }

            // æ›´æ–°ä¸‹æ¬¡æµ‹è¯•æ—¶é—´
            function updateNextTestTime() {
                if (!timerRunning || !timerIntervalMinutes) return;
                
                let nextTime;
                if (timerLastTestTime) {
                    nextTime = new Date(timerLastTestTime.getTime() + timerIntervalMinutes * 60 * 1000);
                } else {
                    nextTime = new Date(new Date().getTime() + timerIntervalMinutes * 60 * 1000);
                }
                
                const timeString = nextTime.toLocaleTimeString('zh-CN', { 
                    hour: '2-digit', 
                    minute: '2-digit',
                    hour12: false 
                });
                document.getElementById('next-test').textContent = timeString;
            }

            // ä¿å­˜å®šæ—¶é…ç½®
            function saveTimerConfig() {
                const timerConfig = {
                    interval: timerIntervalMinutes,
                    completedCycles: completedCycles,
                    lastUpdated: new Date().toISOString()
                };
                localStorage.setItem('timer_config', JSON.stringify(timerConfig));
            }

            // å¤åˆ¶è„šæœ¬
            function copyScript() {
                elements.scriptCode.style.display = 'block';
                
                const githubPagesUrl = window.location.origin + window.location.pathname;
                let scriptText = elements.scriptCode.textContent;
                scriptText = scriptText.replace('YOUR_GITHUB_PAGES_URL_HERE', githubPagesUrl);
                
                navigator.clipboard.writeText(scriptText)
                    .then(() => {
                        const originalText = elements.copyScriptBtn.innerHTML;
                        elements.copyScriptBtn.innerHTML = '<i class="fas fa-check"></i> å·²å¤åˆ¶åˆ°å‰ªè´´æ¿';
                        elements.copyScriptBtn.style.background = '#2ecc71';
                        
                        setTimeout(() => {
                            elements.copyScriptBtn.innerHTML = originalText;
                            elements.copyScriptBtn.style.background = '';
                        }, 2000);
                        
                        showStatus('è„šæœ¬å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼Œè¯·åœ¨Tampermonkeyä¸­å®‰è£…', 'success');
                    })
                    .catch(err => {
                        showStatus('å¤åˆ¶å¤±è´¥: ' + err.message, 'error');
                    });
            }

            // ç›‘å¬æ¥è‡ªTampermonkeyè„šæœ¬çš„æ¶ˆæ¯
            window.addEventListener('message', function(event) {
                if (event.data.type === 'ITDOG_TEST_RESULT') {
                    const { domain, rate, data } = event.data;
                    
                    const domainIndex = domainArray.findIndex(d => d.includes(domain.replace(/^https?:\/\//, '')));
                    
                    if (domainIndex !== -1) {
                        const statusElement = document.getElementById(`status-${domainIndex}`);
                        if (statusElement) {
                            statusElement.textContent = `${rate}%`;
                            statusElement.style.color = rate >= 90 ? '#2ecc71' : '#e74c3c';
                        }
                        
                        addLog(`æµ‹è¯•å®Œæˆ: ${domain} - è¿é€šç‡: ${rate}%`);
                        
                        if (rate < 90) {
                            addLog(`âš ï¸ ${domain} è¿é€šç‡ä½äº90%ï¼Œåº”å·²å‘é€Telegramé€šçŸ¥`);
                        }
                    }
                }
            });

            // äº‹ä»¶ç›‘å¬
            elements.saveConfigBtn.addEventListener('click', saveConfig);
            elements.testConfigBtn.addEventListener('click', testConfig);
            elements.clearConfigBtn.addEventListener('click', clearConfig);
            elements.startTestBtn.addEventListener('click', startBatchTest);
            elements.clearDomainsBtn.addEventListener('click', () => {
                elements.domains.value = '';
            });
            elements.pauseBtn.addEventListener('click', pauseTest);
            elements.stopBtn.addEventListener('click', stopTest);
            elements.copyScriptBtn.addEventListener('click', copyScript);
            elements.startTimerBtn.addEventListener('click', startTimer);
            elements.pauseTimerBtn.addEventListener('click', pauseTimer);
            elements.stopTimerBtn.addEventListener('click', stopTimer);

            // å®šæ—¶é¢‘ç‡é€‰æ‹©å™¨
            elements.scheduleBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    elements.scheduleBtns.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    if (this.dataset.interval === 'custom') {
                        elements.customInterval.style.display = 'block';
                        timerIntervalMinutes = parseInt(elements.customInterval.value) || 60;
                    } else {
                        elements.customInterval.style.display = 'none';
                        timerIntervalMinutes = parseInt(this.dataset.interval) || 60;
                    }
                    
                    // å¦‚æœå®šæ—¶å™¨æ­£åœ¨è¿è¡Œï¼Œé‡æ–°å¯åŠ¨å®šæ—¶å™¨
                    if (timerRunning && !timerPaused) {
                        startTimerInterval();
                    }
                });
            });

            // è‡ªå®šä¹‰é—´éš”è¾“å…¥
            elements.customInterval.addEventListener('input', function() {
                if (timerIntervalMinutes !== parseInt(this.value)) {
                    timerIntervalMinutes = parseInt(this.value) || 60;
                    if (timerRunning && !timerPaused) {
                        startTimerInterval();
                    }
                }
            });

            // åˆå§‹åŒ–
            loadConfig();
            
            // è®¾ç½®ç¤ºä¾‹åŸŸå
            elements.domains.value = `https://www.alibabacloud.com
www.dynadot.com
itdog.cn
godaddy.com
github.com
google.com`;
            
            // å¯åŠ¨å®šæ—¶çŠ¶æ€æ›´æ–°
            setInterval(updateTimerStatus, 60000);
            
            console.log('GitHub Pagesé…ç½®ä¸­å¿ƒå·²åŠ è½½ - æ”¯æŒå®šæ—¶æµ‹è¯•');
        });
    </script>
</body>
</html>
